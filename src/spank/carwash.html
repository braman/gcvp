<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<script type="text/javascript" src="/js/strophe.js"></script>
	<script type="text/javascript" src="/js/xmpp.js"></script>
	<script type="text/javascript" src="/js/jquery.js"></script>
	<link href="/css/carwash.css" rel="stylesheet" type="text/css" />
	<title>Car wash</title>
	<script>
		var templateLoaded = false;
		var html = null;
		
		jQuery(document).ready(function(){
			XmppClient.connect("carwash","q");
			jQuery(".call").click(function(){
				jQuery("#containerPanel").attr("class","kioskPanel");
				jQuery("#containerPanel").html(html);
				templateLoaded = true;
				console.log("Trying to init:"+(typeof _init=="function"));
				if(typeof _init=="function"){
					_init();
				}
			});
		});

		function onMessage(text){
			if(!templateLoaded){
				console.log("onMessage:"+text);
				if(text.indexOf("template")!=-1){
					html = text.substr(13);
					html = html.substr(0,html.length-2);//some bug
				}
			}else{
				_onMessage(text);
			}
		}

		function onStatus(status){
			jQuery("#connectionStatus").text(ruStatuses[status]);
			if(status=="CONNECTED" || status=="ATTACHED"){
				XmppClient.send("queue","template");
			}
			if(templateLoaded){
				_onStatus(status);
			}
		}
	</script>
</head>

<body>
	<header>
		<div id="connectionStatus"></div>	
	</header>
	
	<div id="containerPanel" class="containerPanel">
		<div id="imagePanel">
			<img src="/img/carwash.jpg" style="width:60%;">
		</div>
		<div id="statisticsPanel">
			<div style="text-align: center;"><span>Автомойка на Абая 29</span></div>
			<table style="margin-left:auto;margin-right:auto;width:35%;">
				<tr>
					<td>Кол-во постов:</td><td>6</td>
				</tr>
				<tr>
					<td>Кол-во свободных постов:</td><td>1</td>
				</tr>
				<tr>
					<td>Среднее время обслуживания:</td><td>10 минут</td>
				</tr>
			</table>
			<button type="button" style="float:right;" class="call">Забронировать</button>
		</div>
	</div>
	
	<footer>
		<div id="developer" style="text-align: center;">ТОО "BEE Software"</div>
	</footer>
</body>
</html>
