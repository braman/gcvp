function _init(e){location.href="#!monitor";jQuery("head").append(jQuery("<link rel='stylesheet' href='stylesheets/app.min.css' />"));document.title="CQ - Monitor";if(e.lang){_lang=e.lang;var t="";console.log("Lang: "+_lang);if(_lang=="kk"){kk_ru=_kk}else if(_lang=="ru"){kk_ru=_ru}else if(_lang=="en"){kk_ru=_en}jQuery("#help").append(kk_ru.help);jQuery(".settings").append(kk_ru.settings);jQuery("#logoutLink").append(kk_ru.quit);jQuery("#go_to_statistics").append(kk_ru.go_to_statistics);jQuery("#go_to_tickets").text(kk_ru.go_to_tickets);jQuery(".close").text(kk_ru.close);jQuery(".line").append(kk_ru.line);jQuery(".all").text(kk_ru.all);jQuery(".reserve").text(kk_ru.reserve);jQuery(".serviced").text(kk_ru.serviced);jQuery(".not_came").text(kk_ru.notcame);jQuery(".routed").text(kk_ru.routed);jQuery(".operator").append(kk_ru.operator);jQuery(".window").append(kk_ru.window);jQuery(".call_time").append(kk_ru.call_time);jQuery(".start_time").append(kk_ru.start_time);jQuery("#ticket_number").text(kk_ru.ticket_number);jQuery(".excell").text(kk_ru.excellent);jQuery(".good").text(kk_ru.good);jQuery(".norm").text(kk_ru.norm);jQuery(".veryBad").text(kk_ru.veryBad);jQuery(".bad").text(kk_ru.bad);jQuery("#average").append(kk_ru.average);jQuery(".history").append(kk_ru.hi);jQuery(".ticket").append(kk_ru.ticket);jQuery(".start").append(kk_ru.start);jQuery(".end").append(kk_ru.end);jQuery("#monitoring").text(kk_ru.monitoring);jQuery(".mark").append(kk_ru.mark);jQuery("#number").text(kk_ru.number);jQuery("#create_time").text(kk_ru.create_time);jQuery("#priority").text(kk_ru.priority);jQuery("#waiting_time").text(kk_ru.waiting_time)}jQuery(".error").hide();onConnect()}function onConnect(){XmppClient.send("queue","init")}function _initFromLocalAdmin(e){console.log(e);location.href="#!monitor";document.title="CQ - Monitor";jQuery(".error").hide();_lang=e;var t="";console.log("Lang: "+_lang);if(_lang=="kk"){kk_ru=_kk}else{kk_ru=_ru}jQuery("#help").append(kk_ru.help);jQuery(".settings").append(kk_ru.settings);jQuery("#logoutLink").append(kk_ru.quit);jQuery("#go_to_statistics").append(kk_ru.go_to_statistics);jQuery("#go_to_tickets").text(kk_ru.go_to_tickets);jQuery(".line").append(kk_ru.line);jQuery(".all").append(kk_ru.all);jQuery(".reserve").append(kk_ru.reserve);jQuery("#serviced").append(kk_ru.serviced);jQuery("#not_came").append(kk_ru.notcame);jQuery("#monitoring").text(kk_ru.monitoring);jQuery("#routed").append(kk_ru.routed);jQuery(".operator").append(kk_ru.operator);jQuery("#window").append(kk_ru.window);jQuery("#call_time").append(kk_ru.call_time);jQuery("#start_time").append(kk_ru.start_time);jQuery("#ticket_time").append(kk_ru.ticket_number);jQuery("#excell").append(kk_ru.excellent);jQuery("#good").append(kk_ru.good);jQuery("#bad").append(kk_ru.bad);jQuery("#average").append(kk_ru.average);jQuery(".history").append(kk_ru.hi);jQuery(".ticket").append(kk_ru.ticket);jQuery(".start").append(kk_ru.start);jQuery(".end").append(kk_ru.end);jQuery(".mark").append(kk_ru.mark);onConnect()}function _onMessage(e){console.log("_onMessage:"+e);var t={};try{t=JSON.parse(e)}catch(n){console.warn("unit got non-JSON message:"+e);return}if(t.username){jQuery("#username").text(t.username)}if(t.laneStats){_laneStats=t.laneStats;updateLaneStats()}if(t.unitStats){_unitStats=t.unitStats;jQuery("#unit-stats tbody").empty();jQuery(_unitStats).each(function(e){var t=_unitStats[e];jQuery("#unit-stats tbody").append("<tr data-unit='"+t.username+"'>"+"<td><a href='#' onclick='showUnit(\""+t.username+"\")'>"+t.firstname+" "+t.lastname+"</a></td>"+"<td>"+t.window+"</td>"+"<td data-stat='tokenAll'>"+t.tokenAll+"</td>"+"<td data-stat='countReserved'>"+t.countReserved+"</td>"+"<td data-stat='countMarkGood'>"+t.countMarkBest+"</td>"+"<td data-stat='countMarkNorm'>"+t.countMarkGood+"</td>"+"<td data-stat='countReserved'>"+t.countMarkNorm+"</td>"+"<td data-stat='countMarkGood'>"+t.countMarkBad+"</td>"+"<td data-stat='countMarkBad'>"+t.countMarkVeryBad+"</td>"+"<td data-stat='markAverage'>"+t.markAverage+"</td>"+"</tr>")});jQuery("#unit-mon tbody").empty();jQuery("#mark-stats tbody").empty();jQuery(_unitStats).each(function(e){var t=_unitStats[e];jQuery("#unit-mon tbody").append("<tr data-unit='"+t.username+"'>"+"<td><a href='#' onclick='showUnit(\""+t.username+"\")'>"+t.firstname+" "+t.lastname+"</a></td>"+"<td>"+t.window+"</td>"+"<td data-type='lane'>"+(_lanes[t.lane]!=undefined?_lanes[t.lane]:"")+"</td>"+"<td data-type='called'>"+(t.called!=undefined?t.called:"")+"</td>"+"<td data-type='started'>"+(t.started!=undefined?t.started:"")+"</td>"+"<td data-type='ticket'>"+(t.ticketCode!=undefined?t.ticketCode:"")+"</td>"+"<td data-stat='tokenAll'>"+t.tokenAll+"</td>"+"<td data-stat='countReserved'>"+t.countReserved+"</td>"+"</tr>");jQuery("#mark-stats tbody").append("<tr data-unit='"+t.username+"'>"+"<td><a href='#' >"+t.firstname+" "+t.lastname+"</a></td>"+"<td data-stat='countMarkGood'>"+t.countMarkBest+"</td>"+"<td data-stat='countMarkNorm'>"+t.countMarkGood+"</td>"+"<td data-stat='countReserved'>"+t.countMarkNorm+"</td>"+"<td data-stat='countMarkGood'>"+t.countMarkBad+"</td>"+"<td data-stat='countMarkBad'>"+t.countMarkVeryBad+"</td>"+"<td data-stat='markAverage'>"+t.markAverage+"</td>"+"</tr>")})}if(_laneStats.length==undefined||_unitStats.length==undefined){_msgBuffer.push(t);return}else{if(_msgBuffer.length!=0){jQuery(_msgBuffer).each(function(e){processMessage(_msgBuffer[e])});_msgBuffer=new Array}}processMessage(t);if(t.dateRepresent){jQuery("#representDateLane").text(t.dateRepresent);jQuery("#representDateUnit").text(t.dateRepresent)}_lang=t.lang;if(t.newticket){now=new Date;timeSeconds=now.getHours()*3600+now.getMinutes()*60+now.getSeconds();var r=parseInt(t.newticket.created.substr(0,2))*3600+parseInt(t.newticket.created.substr(3,5))*60+parseInt(t.newticket.created.substr(6,8));console.log(timeSeconds);console.log(r);s=timeSeconds-r;timeArray[t.newticket.tokenId]=s;jQuery("#token-stats tbody").append("<tr data-unit='"+t.newticket.tokenId+"'>"+"<td><a href='#' onclick='showToken(\""+t.newticket.tokenId+"\")'>"+t.newticket.laneRu+"</a></td>"+"<td data-type='ticket'>"+t.newticket.ticket+"</td>"+"<td data-type='window'></td>"+"<td data-type='waiting'>"+t.newticket.created+"</td>"+"<td data-type='called'></td>"+"<td data-type='started'></td>"+"<td data-type='priority'>"+t.newticket.priority+"</td>"+"<td><span id='start-counter"+t.newticket.tokenId+"'>"+"<span id='hours"+t.newticket.tokenId+"'>0</span>:"+"<span id='minutes"+t.newticket.tokenId+"'>00</span>:"+"<span id='seconds"+t.newticket.tokenId+"'>00</span>"+"</span></td>"+"</tr>");if(_msg!=null&&_msg.tokens!=null){_msg.tokens.push(t.newticket)}if(selectedLane!=""&&selectedLane!=t.newticket.lane){jQuery("tbody tr[data-unit='"+t.newticket.tokenId+"']").hide()}}else if(t.priority){var i=jQuery("tr[data-unit='"+t.tokenId+"']");i.find("td[data-type=priority]").text(t.priority)}else if(_lang){if(_lang=="kk"){kk_ru=_kk}else{kk_ru=_ru}jQuery(".settings").empty();jQuery("#help").empty();jQuery("#logoutLink").empty();jQuery("#ticket_title").empty();jQuery("#monitoring_title").empty();jQuery(".line_title").empty();jQuery("#number").text(kk_ru.number);jQuery("#create_time").text(kk_ru.create_time);jQuery("#priority").text(kk_ru.priority);jQuery(".operator_title").empty();jQuery("#window").empty();jQuery("#call_time").empty();jQuery("#start_time").empty();jQuery("#ticket_number").empty();jQuery("#waiting_time").text(kk_ru.waiting_time);jQuery("#average_mark").empty();jQuery(".close").text(kk_ru.close);jQuery(".settings").append(kk_ru.settings);jQuery(".save").text(kk_ru.save);jQuery("#help").append(kk_ru.help);jQuery("#logoutLink").append(kk_ru.quit);jQuery(".close").text(kk_ru.close);jQuery("#ticket_title").append(kk_ru.ticket);jQuery("#monitoring_title").append(kk_ru.monitoring);jQuery(".line_title").append(kk_ru.line);jQuery(".all").text(kk_ru.all);jQuery(".reserve").text(kk_ru.reserve);jQuery(".serviced").text(kk_ru.serviced);jQuery(".not_came").text(kk_ru.not_came);jQuery(".postponed").text(kk_ru.postponed);jQuery(".operator_title").append(kk_ru.operator);jQuery("#window").append(kk_ru.window);jQuery("#call_time").append(kk_ru.call_time);jQuery("#start_time").append(kk_ru.start_time);jQuery("#ticket_number").append(kk_ru.ticket_number);jQuery(".excell").text(kk_ru.excellent);jQuery("#good").text(kk_ru.good);jQuery(".bad").text(kk_ru.bad);jQuery("#average_mark").append(kk_ru.average)}if(t.dateRepresent){jQuery("#representDate").text(t.dateRepresent)}if(t.username){jQuery("#username").text(t.username)}if(t.called){var i=jQuery("tr[data-unit='"+t.tokenId+"']");i.find("td[data-type=called]").text(t.called);i.find("td[data-type=window]").text(t.window)}else if(t.started){var i=jQuery("tr[data-unit='"+t.tokenId+"']");i.find("td[data-type=started]").text(t.started)}else if(t.ended){var i=jQuery("tr[data-unit='"+t.tokenId+"']");i.remove()}if(t.tokens){jQuery("#customDropdown1").append("<option value=''>Все услуги</option>");_msg=t;timeArray=new Array;var s=0;jQuery(t.tokens).each(function(e){var n=t.tokens[e];now=new Date;timeSeconds=now.getHours()*3600+now.getMinutes()*60+now.getSeconds();var r=parseInt(n.waiting.substr(0,2))*3600+parseInt(n.waiting.substr(3,5))*60+parseInt(n.waiting.substr(6,8));console.log(timeSeconds);console.log(r);s=timeSeconds-r;timeArray[n.tokenId]=s;var i="";var o="";var u="";if(n.start!="null"){i=n.start}if(n.call!="null"){o=n.call}if(n.window==n.lane){u=""}else{u=n.window}jQuery("#token-stats tbody").append("<tr data-unit='"+n.tokenId+"'>"+"<td><a href='#' onclick='showToken(\""+n.tokenId+"\")'>"+n.laneRu+"</a></td>"+"<td data-type='ticket'>"+n.ticket+"</td>"+"<td data-type='window'>"+u+"</td>"+"<td data-type='waiting'>"+n.waiting+"</td>"+"<td data-type='called'>"+o+"</td>"+"<td data-type='started'>"+i+"</td>"+"<td data-type='priority'>"+n.priority+"</td>"+"<td><span id='start-counter"+n.tokenId+"'>"+"<span id='hours"+n.tokenId+"'>0</span>:"+"<span id='minutes"+n.tokenId+"'>00</span>:"+"<span id='seconds"+n.tokenId+"'>00</span>"+"</span></td>"+"</tr>")});setTime()}}function processMessage(msg){if(msg.called){var unit=jQuery("tr[data-unit='"+msg.unit+"']");unit.find("td[data-type=ticket]").text(msg.ticket);unit.find("td[data-type=lane]").text(_lanes[msg.lane]);unit.find("td[data-type=called]").text(msg.called);jQuery(_laneStats).each(function(e){var t=_laneStats[e];if(t.lane==msg.lane){t.called+=1}});updateLaneStats();jQuery(_unitStats).each(function(e){var t=_unitStats[e];if(t.username==msg.unit){t.called=msg.called}})}else if(msg.started){var unit=jQuery("tr[data-unit='"+msg.unit+"']");unit.find("td[data-type=ticket]").text(msg.ticket);unit.find("td[data-type=lane]").text(_lanes[msg.lane]);unit.find("td[data-type=started]").text(msg.started);jQuery(_laneStats).each(function(e){var t=_laneStats[e];if(t.lane==msg.lane){t.started+=1}});updateLaneStats();jQuery(_unitStats).each(function(e){var t=_unitStats[e];if(t.username==msg.unit){t.started=msg.started}})}else if(msg.ended){var unit=jQuery("tr[data-unit='"+msg.unit+"']");unit.find("td[data-type]").text("");console.log("msg.ended");var startedTime;var calledTime;var unitRealName;jQuery(_unitStats).each(function(ix){var el=_unitStats[ix];if(el.username==msg.unit){startedTime=el.started;calledTime=el.called;unitRealName=el.firstname+" "+el.lastname;el.ended.push({ticket:msg.ticket,tokenId:msg.tokenId,isTicketReserved:msg.isTicketReserved,lane:msg.lane,call:el.called,start:el.started,end:msg.ended,mark:0});el.called=undefined;el.started=undefined;jQuery(el.ended).each(function(e){var t=el.ended[e];console.log("jel.tokenId == msg.tokenId : "+t.tokenId+" == "+msg.tokenId);if(t.tokenId==msg.tokenId&&t.tokenId!=undefined)t.isTicketReserved=msg.isTicketReserved});unit.find("td[data-stat='tokenAll']").text(msg.tokenAll);if(msg.isTicketReserved){var countReserved=eval(unit.find("td[data-stat='countReserved']").text());unit.find("td[data-stat='countReserved']").text(++countReserved)}unit.find("td[data-stat='countMarkGood']").text(msg.countMarkGood);unit.find("td[data-stat='countMarkNorm']").text(msg.countMarkNorm);unit.find("td[data-stat='countMarkBad']").text(msg.countMarkBad);unit.find("td[data-stat='markAverage']").text(msg.markAverage)}});jQuery(_laneStats).each(function(e){var t=_laneStats[e];if(t.lane==msg.lane&&t.lane!=undefined){console.log("showLane laneFound");console.log(t.history);t.history.push({ticket:msg.ticket,tokenId:msg.tokenId,call:calledTime,start:startedTime,end:msg.ended,mark:2,isTicketReserved:msg.isTicketReserved,unitRealName:unitRealName});t.ended+=1;if(msg.isTicketReserved)t.countReserved+=1}});updateLaneStats()}else if(msg.missed){var unit=jQuery("tr[data-unit='"+msg.unit+"']");unit.find("td[data-type]").text("");jQuery(_laneStats).each(function(e){var t=_laneStats[e];if(t.lane==msg.lane){t.missed+=1}});updateLaneStats();jQuery(_unitStats).each(function(e){var t=_unitStats[e];if(t.username==msg.unit){t.missed.push({ticket:msg.ticket,lane:msg.lane,call:t.called,start:t.started,end:msg.missed});t.called=undefined;t.started=undefined}})}else if(msg.transferred){var unit=jQuery("tr[data-unit='"+msg.unit+"']");unit.find("td[data-type]").text("");jQuery(_laneStats).each(function(e){var t=_laneStats[e];if(t.lane==msg.lane){t.transferred+=1}if(t.lane==msg.nextLane){t.created+=1}});updateLaneStats();jQuery(_unitStats).each(function(e){var t=_unitStats[e];if(t.username==msg.unit){t.transferred.push({ticket:msg.ticket,lane:msg.lane,targetLane:msg.nextLane,call:t.called,start:t.started,end:msg.transferred});t.called=undefined;t.started=undefined}})}else if(msg.newticket){jQuery(_laneStats).each(function(e){var t=_laneStats[e];if(t.lane==msg.newticket.lane){t.created+=1}});updateLaneStats()}else if(msg.smile){console.log("Yahoo! MARK");var unit=jQuery("tr[data-unit='"+msg.unit+"']");jQuery(_unitStats).each(function(e){var t=_unitStats[e];if(t.username==msg.unit){console.log("msg.unit is found");unit.find("td[data-stat='tokenAll']").text(msg.tokenAll);console.log(msg.countMarkGood);unit.find("td[data-stat='countMarkGood']").text(msg.countMarkGood);unit.find("td[data-stat='countMarkNorm']").text(msg.countMarkNorm);unit.find("td[data-stat='countMarkBad']").text(msg.countMarkBad);unit.find("td[data-stat='markAverage']").text(msg.markAverage);jQuery(t.ended).each(function(e){var n=t.ended[e];console.log("jel.tokenId == msg.tokenId : "+n.tokenId+" == "+msg.tokenId);if(n.tokenId==msg.tokenId&&n.tokenId!=undefined)n.mark=msg.mark});t.tokenAll=msg.tokenAll;t.countMarkGood=msg.countMarkGood;t.countMarkNorm=msg.countMarkNorm;t.countMarkBad=msg.countMarkBad;t.markAverage=msg.markAverage}});jQuery(_laneStats).each(function(e){var t=_laneStats[e];if(t.lane==msg.lane&&t.lane!=undefined){jQuery(t.history).each(function(e){var n=t.history[e];console.log("jel.tokenId == msg.tokenId : "+n.tokenId+" == "+msg.tokenId);if(n.tokenId==msg.tokenId&&n.tokenId!=undefined)n.mark=msg.mark})}})}console.log(msg)}function getUnit(e){var t={};jQuery(_unitStats).each(function(n){if(_unitStats[n].username==e){t=_unitStats[n]}});return t}function updateLaneStats(){jQuery("#lane-mon tbody tr").remove();jQuery(_laneStats).each(function(e){var t=_laneStats[e];_lanes[t.lane]=t.laneText;jQuery("#lane-mon tbody").append("<tr data-lane='"+t.lane+"'><td><a href='javascript:showLane(\""+t.lane+"\")' >"+t.laneText+"</a></td><td>"+t.created+"</td><td>"+t.countReserved+"</td><td>"+t.ended+"</td><td>"+t.missed+"</td><td>"+t.transferred+"</td></tr>")});jQuery("#lane-stats tbody tr").remove();jQuery(_laneStats).each(function(e){var t=_laneStats[e];_lanes[t.lane]=t.laneText;jQuery("#lane-stats tbody").append("<tr data-lane='"+t.lane+"'><td><a href='javascript:showLane(\""+t.lane+"\")' >"+t.laneText+"</a></td><td>"+t.created+"</td><td>"+t.countReserved+"</td><td>"+t.ended+"</td><td>"+t.missed+"</td><td>"+t.transferred+"</td></tr>")})}function showLane(e){jQuery(_laneStats).each(function(t){var n=_laneStats[t];if(e==n.lane&&n.lane!=undefined){jQuery("#laneModal legend div span#laneName").text(kk_ru.line+": "+n.laneText);$laneModal=jQuery("#laneModal tbody");$laneModal.empty();console.log("showLane laneFound");console.log(n.history);for(var r in n.history){var i=n.history[r];console.log(i);$laneModal.append("<tr>");$laneModal.append("<td>"+i.unitRealName+"</td>");var s=i.isTicketReserved?" "+kk_ru.reserve:"";$laneModal.append("<td>"+i.ticket+s+"</td>");$laneModal.append("<td>"+(i.start!="null"?i.start:"")+"</td><td>"+(i.end!="null"?i.end:"")+"</td>");var o="";switch(i.mark){case 0:o="";break;case 5:o=kk_ru.excellent;break;case 4:o=kk_ru.good;break;case 3:o=kk_ru.norm;break;case 2:o=kk_ru.bad;break;case 1:o=kk_ru.veryBad;break}jQuery("#laneModal tbody").append("<td>"+o+"</td>");jQuery("#laneModal tbody").append("</tr>")}$("#laneModal").foundation("reveal","open")}});return false}function showUnit(e){jQuery(_unitStats).each(function(t){var n=_unitStats[t];if(e.indexOf(n.username)!=-1){jQuery("#unitModal legend div span#unitRealname").text("Оператор: "+n.firstname+" "+n.lastname);jQuery("#unitModal legend div span#unitUsername").text("Логин: "+n.username);jQuery("#unitModal ul.unitLanes").empty();jQuery(n.lanes).each(function(e){jQuery("#unitModal ul.unitLanes").append("<li><span class='label'>"+n.lanes[e].laneText+"</span></li>")});jQuery("#unitModal tbody").empty();jQuery(n.ended).each(function(e){var t=n.ended[e];var r=t.laneText;if(r==undefined){for(var i in _lanes)if(i==t.lane){r=_lanes[i];break}}jQuery("#unitModal tbody").append("<tr>");jQuery("#unitModal tbody").append("<td>"+r+"</td>");var s=t.isTicketReserved?" Бронь":"";console.log("jel.isTicketReserved = "+t.isTicketReserved+" isReservedText = "+s);jQuery("#unitModal tbody").append("<td>"+t.ticket+s+"</td>");jQuery("#unitModal tbody").append("<td>"+t.start+"</td><td>"+t.end+"</td>");var o="";switch(t.mark){case 0:o="";break;case 5:o=kk_ru.excellent;break;case 4:o=kk_ru.good;break;case 3:o=kk_ru.norm;break;case 2:o=kk_ru.bad;break;case 1:o=kk_ru.veryBad;break}jQuery("#unitModal tbody").append("<td>"+o+"</td>");jQuery("#unitModal tbody").append("</tr>")});$("#unitModal").foundation("reveal","open")}});return false}function goToAdmin(){console.log("gotolocaladmin");jQuery("#body").load("localAdmin.html",function(e){if(typeof _init=="function"){console.log(_lang);_init("ru")}jQuery("#body").show()})}function _onStatus(e){if(e=="CONNECTED"||e=="ATTACHED"){onConnect()}if(e=="DISCONNECTED"){console.log("Disconnected")}}function getSettings(){jQuery("#messageBody").html("<p>"+kk_ru.choose_lang+"</p>"+'<label for="ru_lang"><input type="radio" id="ru_lang" name="lang" value="ru" />Русский</label>'+'<label for="kk_lang"><input type="radio" id="kk_lang" name="lang" value="kk" />Казахский</label>'+'<label for="en_lang"><input type="radio" id="en_lang" name="lang" value="en" />English</label>');$("#message").foundation("reveal","open")}function change_lang(){var e=document.getElementsByName("lang");for(var t=0;t<e.length;t++){if(e[t].checked){_lang=e[t].value}}if(_lang=="kk"){kk_ru=_kk}else if(_lang=="ru"){kk_ru=_ru}else if(_lang=="en"){kk_ru=_en}jQuery("#help").empty();jQuery("#help").append(kk_ru.help);jQuery(".settings").empty();jQuery(".settings").append(kk_ru.settings);jQuery("#logoutLink").empty();jQuery("#logoutLink").append(kk_ru.quit);jQuery("#go_to_statistics").empty();jQuery("#go_to_statistics").append(kk_ru.go_to_statistics);jQuery("#go_to_tickets").text(kk_ru.go_to_tickekk_ru.go_to_statisticsts);jQuery(".line").empty();jQuery(".line").append(kk_ru.line);jQuery(".all").text(kk_ru.all);jQuery(".reserve").text(kk_ru.reserve);jQuery(".serviced").text(kk_ru.serviced);jQuery(".not_came").text(kk_ru.notcame);jQuery(".routed").text(kk_ru.routed);jQuery(".operator").empty();jQuery(".operator").append(kk_ru.operator);jQuery("#window").empty();jQuery("#window").append(kk_ru.window);jQuery("#call_time").empty();jQuery("#call_time").append(kk_ru.call_time);jQuery("#start_time").empty();jQuery("#start_time").append(kk_ru.start_time);jQuery("#ticket_time").empty();jQuery("#ticket_time").append(kk_ru.ticket_number);jQuery(".excell").text(kk_ru.excellent);jQuery("#good").text(kk_ru.good);jQuery(".bad").text(kk_ru.bad);jQuery("#average").empty();jQuery("#average").append(kk_ru.average);jQuery(".history").empty();jQuery(".history").append(kk_ru.hi);jQuery(".ticket").empty();jQuery(".ticket").append(kk_ru.ticket);jQuery(".start").empty();jQuery(".start").append(kk_ru.start);jQuery(".end").empty();jQuery(".end").append(kk_ru.end);jQuery(".mark").empty();jQuery(".mark").append(kk_ru.mark);jQuery("#monitoring").text(kk_ru.monitoring);console.log("LANGUAGE IS: "+_lang);$("#message").foundation("reveal","close");XmppClient.send("queue",JSON.stringify({action:"changeLang",user:sessionStorage.jid,language:_lang}))}function saveText(){var e=kk_ru.line+";"+kk_ru.all+";"+kk_ru.reserve+";"+kk_ru.serviced+";"+kk_ru.notcame+";"+kk_ru.routed+"\n";jQuery(_laneStats).each(function(t){var n=_laneStats[t];e+=n.laneText+";"+n.created+";"+n.countReserved+";"+n.ended+";"+n.missed+";"+n.transferred+"\n"});var t=new Blob([e],{type:"text/plain;charset=Unicode"});saveAs(t,"monitor_lane.csv");return false}function saveUnitText(){var e=kk_ru.operator+";"+kk_ru.window+";"+kk_ru.line+";"+kk_ru.call_time+";"+kk_ru.start_time+";"+kk_ru.ticket_number+";"+kk_ru.all+";"+kk_ru.reserve+"\n";jQuery(_unitStats).each(function(t){var n=_unitStats[t];e+=n.firstname+" "+n.lastname+";"+n.window+";"+(_lanes[n.lane]!=undefined?_lanes[n.lane]:"")+";"+(n.called!=undefined?n.called:"")+";"+(n.started!=undefined?n.started:"")+";"+(n.ticketCode!=undefined?n.ticketCode:"")+";"+n.tokenAll+";"+n.countReserved+"\n"});var t=new Blob([e],{type:"text/plain;charset=Unicode"});saveAs(t,"monitor_unit.csv");return false}function setTime(){jQuery(timeArray).each(function(e){totalSeconds=++timeArray[e];$("#seconds"+e).text(pad(totalSeconds%60));$("#minutes"+e).text(pad(parseInt(totalSeconds%3600/60)));$("#hours"+e).text(pad(parseInt(totalSeconds/3600)))});setTimeout(setTime,1e3)}function pad(e){var t=e+"";if(t.length<2){return"0"+t}else{return t}}function changeLanes(e){console.log(e);if(e!=""){jQuery("tbody tr").hide();jQuery(_msg.tokens).each(function(t){var n=_msg.tokens[t];if(n.laneRu){if(e==n.laneRu){jQuery("tbody tr[data-unit='"+n.tokenId+"']").show()}}else if(n.lane){if(e==n.lane){jQuery("tbody tr[data-unit='"+n.tokenId+"']").show()}}})}else{jQuery("tr").show()}}function showToken(e){console.log(e);_id=e;jQuery(_msg.tokens).each(function(t){var n=_msg.tokens[t];if(n.tokenId==e){$("#priorityInput").val(n.priority);$("#tokenModal").foundation("reveal","open")}})}function save(){var e=$("#priorityInput").val();console.log(e);$("#tokenModal").foundation("reveal","close");var t={action:"editPriority"};t.id=_id;t.priority=e;id=null;XmppClient.send("queue",JSON.stringify(t))}function saveTicketText(){var e=kk_ru.line+";"+kk_ru.number+";"+kk_ru.window+";"+kk_ru.create_time+";"+kk_ru.call_time+";"+kk_ru.start_time+";"+kk_ru.priority+";"+kk_ru.waiting_time+"\n";jQuery(_msg.tokens).each(function(t){var n=_msg.tokens[t];var r="";var i="";var s="";if(n.start!="null"){r=n.start}if(n.call!="null"){i=n.call}if(n.window==n.lane){s=""}else{s=n.window}e+=n.laneRu+";"+n.ticket+";"+s+";"+n.waiting+";"+i+";"+r+";"+n.priority+";"+$("#hours"+n.tokenId).text()+" "+$("#minutes"+n.tokenId).text()+" "+$("#second"+n.tokenId).text()+"\n"});var t=new Blob([e],{type:"text/plain;charset=Unicode"});saveAs(t,"monitor_ticket.csv");return false}function saveMarkText(){var e=kk_ru.operator+";"+kk_ru.excellent+";"+kk_ru.good+";"+kk_ru.norm+";"+kk_ru.bad+";"+kk_ru.veryBad+";"+kk_ru.average+"\n";jQuery(_unitStats).each(function(t){var n=_unitStats[t];e+=n.firstname+" "+n.lastname+";"+n.countMarkBest+";"+n.countMarkGood+";"+n.countMarkNorm+";"+n.countMarkBad+";"+ +n.countMarkVeryBad+";"+n.markAverage+"\n"});var t=new Blob([e],{type:"text/plain;charset=Unicode"});saveAs(t,"mark_unit.csv");return false}function showRepresentDate(){console.log("showRepresentdate");var e=new Date;var t=new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0,0);var n=$("#datepickerFrom").fdatepicker({format:"dd.mm.yyyy"}).on("changeDate",function(e){if(e.date.valueOf()>r.date.valueOf()){var t=new Date(e.date);t.setDate(t.getDate()+1);r.setValue(t)}n.hide();$("#datepickerTo")[0].focus()}).data("datepicker");var r=$("#datepickerTo").fdatepicker({format:"dd.mm.yyyy",onRender:function(e){return e.valueOf()<=n.date.valueOf()?"disabled":""}}).on("changeDate",function(e){r.hide()}).data("datepicker");if(firstTime==0){$("body").append(jQuery("<script src='javascripts/foundation/foundation.datepicker.js'></script"))}$("#representDateModal").foundation("reveal","open")}function isDate(e,t,n,r,i){try{e=e.replace(/-/g,"/").replace(/\./g,"/");t=t===undefined?"/":t.replace(/-/g,"/").replace(/\./g,"/");var s=e.split(t);if(s.length!=3){return false}if(n===undefined||r===undefined||i===undefined){if(s[0]>31){i=0;r=1;n=2}else{i=2;r=1;n=0}}var o=n!==undefined?n:0;var u=r!==undefined?r:1;var a=i!==undefined?i:2;console.log(s);console.log(o);console.log(u);console.log(a);var f=true;if(!(s[o].length==1||s[o].length==2)){f=false}console.log(f);if(f&&!(s[u].length==1||s[u].length==2)){f=false}console.log(f);if(f&&s[a].length!=4){f=false}console.log(f);if(f){var l=parseInt(s[o],10);var c=parseInt(s[u],10);var h=parseInt(s[a],10);var p=[31,28,31,30,31,30,31,31,30,31,30,31];if(f=c<=12&&c>0){var d=(h&3)==0&&(h%25!=0||(h&15)==0);p[1]=d?29:28;f=l>0&&l<=p[c-1]}}console.log(f);return f}catch(v){return false}}function goToDate(){var e=jQuery("#datepickerFrom").val();var t=jQuery("#datepickerTo").val();console.log(e);if(!isDate(e,".")){jQuery("label#datepickerFrom_error").html("Некорректная дата.");jQuery("label#datepickerFrom_error").show();jQuery("input#datepickerFrom").focus();return}if(!isDate(t,".")){jQuery("label#datepickerTo_error").html("Некорректная дата.");jQuery("label#datepickerTo_error").show();jQuery("input#datepickerTo").focus();return}jQuery(".error").hide();$("#representDateModal").foundation("reveal","close");var n={action:"monitor_representDate",dateFrom:e,dateTo:t};XmppClient.send("queue",JSON.stringify(n))}function saveLaneStat(){var e=jQuery("#representDateLane").text()+"\n"+kk_ru.line+";"+kk_ru.all+";"+kk_ru.reserve+";"+kk_ru.serviced+";"+kk_ru.notcame+";"+kk_ru.routed+"\n";jQuery(_laneStats).each(function(t){var n=_laneStats[t];e+=n.laneText+";"+n.created+";"+n.countReserved+";"+n.ended+";"+n.missed+";"+n.transferred+"\n"});var t=new Blob([e],{type:"text/plain;charset=Unicode"});saveAs(t,"statistics_lane.csv");return false}function saveUnitStat(){var e=jQuery("#representDateUnit").text()+"\n"+kk_ru.operator+";"+kk_ru.window+";"+kk_ru.all+";"+kk_ru.reserve+";"+kk_ru.excellent+";"+kk_ru.good+";"+kk_ru.norm+";"+kk_ru.bad+";"+kk_ru.veryBad+";"+kk_ru.average+"\n";jQuery(_unitStats).each(function(t){var n=_unitStats[t];e+=n.firstname+" "+n.lastname+";"+n.window+";"+n.tokenAll+";"+n.countReserved+";"+n.countMarkBest+";"+n.countMarkGood+";"+n.countMarkNorm+";"+n.countMarkBad+";"+n.countMarkVeryBad+";"+n.markAverage+"\n"});var t=new Blob([e],{type:"text/plain;charset=Unicode"});saveAs(t,"statistics_unit.csv");return false}var _kk={help:"Көмек",settings:"Қондырғылар",quit:"Шығу",monitoring:"Бақылау",go_to_statistics:"Санаққа өту",go_to_tickets:"Текущие билеты",line:"Қызмет тізімі",all:"Барлығы",reserve:"Бронь",serviced:"Қызмет корсетілген",notcame:"Келмеген клиенттер",routed:"Қайта бағытталған",operator:"Оператор",window:"Терезе",close:"Закрыть",waiting_time:"Время ожидания",create_time:"Время распечатки",call_time:"Шақырылған уақыты",start_time:"Басталған уақыты",ticket_number:"Билет нөмірі",excellent:"Өте жақсы",priority:"Приоритет",norm:"Орташа",good:"Жақсы",bad:"Жаман",save:"Сохранить",veryBad:"Өте жаман",average:"Орташа бағасы",history:"Тарихы",ticket:"Билет",start:"Басы",end:"Соңы",mark:"Бағасы",choose_lang:"Тіл таңдаңыз"};var _ru={help:"Помощь",waiting_time:"Время ожидания",settings:"Настройки",quit:"Выход",monitoring:"Мониторинг",go_to_statistics:"Перейти на статистику",go_to_tickets:"Текущие билеты",line:"Услуги",all:"Всего",reserve:"Бронь",serviced:"Обслужено",notcame:"Клиент не пришел",routed:"Перенаправленные",operator:"Оператор",window:"Окно",call_time:"Время вызова",start_time:"Время начала",ticket_number:"Номер билета",close:"Закрыть",number:"Номер",create_time:"Время распечатки",priority:"Приоритет",waiting_time:"Время ожидания",save:"Сохранить",good:"Хорошо",veryBad:"Очень плохо",excellent:"Отлично",norm:"Удовлетворительно",bad:"Плохо",average:"Средняя оценка",history:"История",ticket:"Билет",start:"Начало",end:"Конец",mark:"Оценка",choose_lang:"Выберите язык"};var _unitStats={};var _laneStats={};var _lanes={};var _msgBuffer=new Array;var _lang=null;var kk_ru=_ru;var _msgBuffer=new Array;jQuery("#logoutLink").click(function(){console.log("logoutLink was clicked");window.location="/";sessionStorage.clear();XmppClient.connection.disconnect()});var totalSeconds=0;var _msg=null;var _lang=null;var _id=null;var timeArray=new Array;var selectedLane="";jQuery(document).ready(function(){$("#customDropdown1").change(function(){jQuery(this).removeAttr("selected");var e=$(this).find(":selected").text();selectedLane=jQuery("#customDropdown1").val();console.log(e);changeLanes(selectedLane)})});var firstTime=0;var nowTemp=new Date;var now=new Date(nowTemp.getFullYear(),nowTemp.getMonth(),nowTemp.getDate(),0,0,0,0)