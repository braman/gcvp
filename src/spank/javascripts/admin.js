    var _kk = {
        lanesTab:"Қызметтер",
        unitsTab:"Операторлар",
        dashboardsTab:"Экрандар",
        kiosksTab:"Киосктер",
        logosTab:"Логотиптер",
        templatesTab:"Үлгілер",
        logosTabHeader:"Логотиптер",
        templatesTabHeader:"Үлгілер",
        weekends_title: "Демалыс күндер",
        list_of_holidays: "Қысқа күндер",
        weekendDaysButton: "Сақтау",
        label_of_weekends: "Демалыс күндер тандаңыз",

        enable:"Іске қосу",
        disable:"Өшіру",
        saveChanges:"Сақтау",
        close:"Жабу",
        deleteLink:"Жою",

        createUnit:"Операторды қосу",
        createLane:"Қызметті қосу",
        createKiosk:"Киоскты қосу",
        createQuestion:"Сұрақты қосу",
        createDashboard:"Экранды қосу",
        createStatistics:"Статистиканы қосу",
        
        laneUsername:"Қызмет",
        laneStartRange:"Алғашқы нөмір",
        laneEndRange:"Соңғы нөмір",
        laneColor:"Түсі",
        priority:"Приоритет",

        kiosk:"Киоск",
        statistics:"Статистика",
        unit:"Оператор",
        dashboard:"Экран",
        ticket:"Билет",
        unitLanes:"Оператордың қызметтері",
        dashboardLanes:"Экрандағы қызметтер",
        lanes:"Қызметтер",
        username:"Логин",
        password:"Құпия сөз",
        firstname:"Аты",
        lastname:"Жөні",
        loginHelp:"Барлық бас әріптер кіші әріптерге ауыстырылады",
        kioskHelp:"Егер қызметтер тобын қоспасаңыз, киоскте барлық қызметтер көрсетіледі",
        mainLaneKK:"Топтың аты (қазақша)",
        mainLaneRU:"Топтың аты (орысша)",
        mainLanes:"Қызметтер тобы",
        create:"Қосу",
        laneRU:"Қызметтің аты (орысша)",
        laneKK:"Қызметтің аты (қазақша)",
        laneEN:"Қызметтің аты (ағылшынша)",
        help: "Көмек",
        settings: "Қондырғылар",
        quit: "Шығу",
        filials: "Бөлімшелер:",
        laneEN:"Название услуги (eng)",
        account: "Аккаунт",
        question: "Сұрақтар",
        answer1: "Первый ответ",
        answer2: "Второй ответ",
        answer3: "Третий ответ",
        answer4: "Четвертый ответ",
        answer5: "Пятый ответ",
        newSecondMonitor: "Мониторды қосу",
        choose_lang: "Тіл таңдаңыз",
        choose_second_monitor: "Екінші мониторды таңдаңыз",
        chooseFilial: "Бөлімшелерді таңдаңыз",
        anketa:"Анкета",
        modal:{
            unit:{
                title:"Оператор",
                header:"Жаңа мәліметтер енгізіңіз",
            },
            lane:{
                title:"Қызмет",
                header:"Жаңа мәліметтер енгізіңіз"
            },
            dashboard:{
                title:"Экран",
                header:"Жаңа мәліметтер енгізіңіз"
            },
            secondMonitor:{
                title:"Клиенттің мониторы",
                header:"Жаңа мәліметтер енгізіңіз"
            },
            kiosk:{
                title:"Киоск",
                header1:"Қызметтер тобы",
                header2:"Киоск мәліметтері"
            },
            anketa:{
                title:"Анкета",
                header:"Жаңа сұрақ енгізіңіз",
            }
        },
        
        days:{
    		d1:"Дүйсенбі",
    		d2:"Сейсенбі",
    		d3:"Сәрсенбі",
    		d4:"Четверг",
    		d5:"Бейсенбі",
    		d6:"Сенбі",
    		d7:"Жексенбі"
    	},
    	video_title : 'title',
    	play_video : 'play video',
    	playLeft : 'left play',
    	playRight : 'right play',
    	playAll : 'all play',
    	stopLeft : 'left stop',
    	stopRight : 'right stop',
    	stopAll : 'all stop',
    	updateLink: 'update link',
    	runningLine : 'бегущяя строка',
    	add_video_path : 'add video path'
    };

    var _ru = {
        lanesTab:"Услуги",
        unitsTab:"Операторы",
        dashboardsTab:"Экраны",
        kiosksTab:"Киоски",
        logosTab:"Логотипы",
        templatesTab:"Шаблоны",
        logosTabHeader:"Логотипы",
        anketaTabHeader:"Анкета",
        templatesTabHeader:"Шаблоны",
        weekends_title: "Выходные",
        statistics:"Статистика",
        weekendDaysButton: "Сохранить",
        label_of_weekends: "Выберите выходные",
        
        enable:"Активировать",
        disable:"Отключить",
        saveChanges:"Сохранить",
        close:"Закрыть",
        deleteLink:"Удалить",
        list_of_holidays: "Короткие дни",

        createUnit:"Добавить оператора",
        createLane:"Добавить услугу",
        createKiosk:"Добавить киоск",
        createQuestion:"Добавить вопрос",
        createDashboard:"Добавить экран",
        createStatistics:"Добавить статистику",
        
        laneUsername:"Услуга",
        laneStartRange:"Стартовый номер",
        laneEndRange:"Конечный номер",
        laneColor:"Цвет (hex)",
        priority:"Приоритет",
        kiosk:"Киоск",
        anketa:"Анкета",
        unit:"Оператор",
        dashboard:"Экран",
        ticket:"Билет",
        unitLanes:"Услуги оператора",
        dashboardLanes:"Услуги экрана",
        lanes:"Услуги",
        username:"Логин",
        password:"Пароль",
        firstname:"Имя",
        lastname:"Фамилия",
        loginHelp:"Все заглавные буквы конвертируются в маленькие",
        kioskHelp:"Если вы не добавите групповые услуги то на киоске будут отображаться все услуги",
        mainLaneKK:"Название группы на казахском",
        mainLaneRU:"Название группы на русском",
        mainLanes:"Групповые услуги",
        create:"Добавить",
        laneRU:"Название услуги (рус)",
        laneKK:"Название услуги (каз)",
        laneEN:"Название услуги (eng)",
        help: "Помощь",
        settings: "Настройки",
        quit: "Выход",
        filials: "Филиалы:",
        laneEN:"Название услуги (eng)",
        account: "Аккаунт",
        question: "Вопрос",
        answer1: "Первый ответ",
        answer2: "Второй ответ",
        answer3: "Третий ответ",
        answer4: "Четвертый ответ",
        answer5: "Пятый ответ",
        newSecondMonitor: "Добавить Монитор",
        choose_lang: "Выберите язык",
        choose_second_monitor: "Выберите второй монитор",
        chooseFilial: "Выберите филиал",
        modal:{
            unit:{
                title:"Оператор",
                header:"Введите новые данные",
            },
            lane:{
                title:"Услуга",
                header:"Введите новые данные"
            },
            dashboard:{
                title:"Экран",
                header:"Введите новые данные"
            },
            secondMonitor:{
                title:"Второй Монитор",
                header:"Введите новые данные"
            },
            kiosk:{
                title:"Киоск",
                header1:"Групповые услуги",
                header2:"Данные киоска"
            },
            anketa:{
                title:"Анкета",
                header:"Введите новые вопрос",
            }
        },
    	days:{
    		d1:"Понедельник",
    		d2:"Вторник",
    		d3:"Среда",
    		d4:"Четверг",
    		d5:"Пятница",
    		d6:"Суббота",
    		d7:"Воскресенье"
    	},
    	video_title : 'title',
    	play_video : 'play video',
    	playLeft : 'left play',
    	playRight : 'right play',
    	playAll : 'all play',
    	stopLeft : 'left stop',
    	stopRight : 'right stop',
    	stopAll : 'all stop',
    	updateLink: 'update link',
    	runningLine : 'бегущяя строка',
    	add_video_path : 'add video path'
    };
    

    var _obj = null;
    var _users = null;
    var _initData = null;
    var _lanes = null;
    var msg1 = {};
    var _laneTree = null;
	var selectedGroup = null;
	var _secondMonitor = [];
	var kk_ru = null;
	var _lang = null;
	var _count = new Array();
	var _status = new Array();
	var _weekends_days = null;

	var questionEdit = 0;
	var answersId = new Array(0,0,0,0,0);
	
	jQuery(document).ready(function(){
		$(function() {
			window.prettyPrint && prettyPrint();
			$('#dp1').fdatepicker({
				format: 'mm-dd-yyyy'
			});
			$('#dp2').fdatepicker({
				closeButton: true
			});
			var nowTemp = new Date();
			var now = new Date(nowTemp.getFullYear(), nowTemp.getMonth(), nowTemp.getDate(), 0, 0, 0, 0);
			$('#dp3').fdatepicker({
				onRender: function (date) {
					return date.valueOf() < now.valueOf() ? 'disabled' : '';
				}
			});
			$('#dp-margin').fdatepicker();
			$('#dpYears').fdatepicker();
			$('#dpMonths').fdatepicker();
			var startDate = new Date(2012, 1, 20);
			var endDate = new Date(2012, 1, 25);
			$('#dp4').fdatepicker()
				.on('changeDate', function (ev) {
				if (ev.date.valueOf() > endDate.valueOf()) {
					$('#alert').show().find('strong').text('The start date can not be greater then the end date');
				} else {
					$('#alert').hide();
					startDate = new Date(ev.date);
					$('#startDate').text($('#dp4').data('date'));
				}
				$('#dp4').fdatepicker('hide');
			});
			$('#dp5').fdatepicker()
				.on('changeDate', function (ev) {
				if (ev.date.valueOf() < startDate.valueOf()) {
					$('#alert').show().find('strong').text('The end date can not be less then the start date');
				} else {
					$('#alert').hide();
					endDate = new Date(ev.date);
					$('#endDate').text($('#dp5').data('date'));
				}
				$('#dp5').fdatepicker('hide');
			});
			// implementation of disabled form fields
			var nowTemp = new Date();
			var now = new Date(nowTemp.getFullYear(), nowTemp.getMonth(), nowTemp.getDate(), 0, 0, 0, 0);
			var checkin = $('#dpd1').fdatepicker({
				onRender: function (date) {
					return date.valueOf() < now.valueOf() ? 'disabled' : '';
				}
			}).on('changeDate', function (ev) {
				if (ev.date.valueOf() > checkout.date.valueOf()) {
					var newDate = new Date(ev.date)
					newDate.setDate(newDate.getDate() + 1);
					checkout.setValue(newDate);
				}
				checkin.hide();
				$('#dpd2')[0].focus();
			}).data('datepicker');
			var checkout = $('#dpd2').fdatepicker({
				onRender: function (date) {
					return date.valueOf() <= checkin.date.valueOf() ? 'disabled' : '';
				}
			}).on('changeDate', function (ev) {
				checkout.hide();
			}).data('datepicker');
		});
});
	
    $('#customDropdown1').change(function() {
    	jQuery(this).removeAttr("selected");
        var selected = $(this).find(":selected").text();
    	selectedGroup = jQuery('#customDropdown1').val();
		console.log(selectedGroup);
    	goToFilial();
    });
    
    function save(modal){
		var type = modal.toLowerCase();
		var id = 'modal'+modal
        var msg = {action:"admin"};
        var loginField = jQuery("#"+type+"Login");
        console.log(loginField);

        var actionType = "createUser";
        if(loginField.attr("disabled")){
            actionType = "editUser";
        }
        var pwd = jQuery("#"+type+"Password").val();
        var selectedLanes = jQuery("#"+type+"Lanes").val();
        msg.role = type.toUpperCase();
        console.log ('111111111111111111111100000000000000000000000');
        console.log (selectedLanes);
        
        var selectedLanes1 = new Array ();
        jQuery(selectedLanes).each(function(ix){
            var el = selectedLanes[ix];                
            jQuery(_users).each(function(i){
                var user = _users[i];
                if(user.ru){
                	if(user.ru==el){
                        selectedLanes1[ix] = user.user;
                    }
                }else if(user.kk){
                	if(user.kk==el){
                        selectedLanes1[ix] = user.user;
                    }
                }
            });
        });
        console.log (selectedLanes1);     
        
        if(id=="modalQuestion"){
            console.log('modalQuestion');
            msg.questionId = questionEdit;
            msg.question = jQuery("#question").val();
            msg.answer1 = jQuery("#answer1").val();
            msg.answer2 = jQuery("#answer2").val();
            msg.answer3 = jQuery("#answer3").val();
            msg.answer4 = jQuery("#answer4").val();
            msg.answer5 = jQuery("#answer5").val();
            
            msg.id1 = answersId[0];
            msg.id2 = answersId[1];
            msg.id3 = answersId[2];
            msg.id4 = answersId[3];
            msg.id5 = answersId[4];
            
            if(questionEdit>0){
            	actionType = "editUser";
            	answersId = new Array(0,0,0,0,0);
            	questionEdit = 0;
            }
            $('#modalQuestion').foundation('reveal', 'close');
        }else if(id=="modalLane"){
        	console.log('modalLane1111111111');
            console.log('ActionType = ' + actionType);
            msg.startRange = jQuery("#"+type+"StartRange").val();
            msg.endRange = jQuery("#"+type+"EndRange").val();
            msg.color = jQuery("#"+type+"Color").val();
            msg.priority = jQuery("#"+type+"Priority").val();
            msg.kk = jQuery("#"+type+"KK").val();
            msg.en = jQuery("#"+type+"EN").val();
            msg.ru = jQuery("#"+type+"RU").val();
            $('#modalLane').foundation('reveal', 'close');
        }else if(id=="modalStatistics"){
            console.log('modalStatistics');
            msg.role = 'MONITOR';
            $('#modalStatistics').foundation('reveal', 'close');
        }else if(id=="modalUnit"){
        	console.log('modal unit');
            msg.firstname = jQuery("#"+type+"Firstname").val();
            msg.lastname = jQuery("#"+type+"Lastname").val();
            msg.window = jQuery("#"+type+"Window").val();
            msg.lanes = selectedLanes1;
            if(jQuery('#unitSecondMonitor').val() != 'null'){
            	msg.secondMonitor = jQuery('#unitSecondMonitor').val();                
			}
            console.log(msg.secondMonitor);
            $('#modalUnit').foundation('reveal', 'close');
        }else if(id=="modalDashboard"){
            msg.lanes = selectedLanes1;
            $('#modalDashboard').foundation('reveal', 'close');
        }else if(id=="modalSecondMonitor"){
        	msg.role = 'SECOND_MONITOR';
            $('#modalSecondMonitor').foundation('reveal', 'close');
        }else if(id=="modalKiosk"){
        	                
            var mainLaneArr = new Array();
            jQuery("#modalKiosk table tr").each(function(){
                var kkName = jQuery(this).find("td:eq(0)").text();
                var ruName = jQuery(this).find("td:eq(1)").text();
                var laneArr = jQuery(this).find("td:eq(2)").text().split(",");
                
                var laneArr1 = new Array ();
                console.log ('--------------------------------');
                
                jQuery(laneArr).each(function(k){
                    jQuery(_users).each(function(i){
                    	var user = _users[i];
                        if (user.role == 'LANE'){
                       	    if(user.ru==laneArr[k]){
                                laneArr1[k] = user.user;
                                console.log (laneArr1[k]);
                            }                               
                        }	                        	                        
                    });
                });    
                mainLaneArr.push({kk:kkName,ru:ruName,sublanes:laneArr1});
            });
            msg.mainLanes = mainLaneArr;
            $('#modalKiosk').foundation('reveal', 'close');
        }
        msg.type = actionType;
        msg.username = loginField.val();
        msg.password = pwd==undefined?"":pwd;
        console.log(_group);
        msg.group = selectedGroup;
        console.log(msg);
        XmppClient.send("queue",JSON.stringify(msg));
    }
    
    function saveHoliday(){
    	msg = {
    			action: 'admin_holiday',
    			date: jQuery('#date').val(),
    			time: jQuery('#time').val(),
    			group_name: jQuery('#groups_select').val()
    	};
    	XmppClient.send("queue",JSON.stringify(msg));
    }
    
    function saveWeekends(){
    	var days = "";
    	
    	for(var i = 1; i <= 7; i++){
    		if(jQuery("#d"+i).is(':checked')){
    			days = days +""+ i; 
    		}
    	}
    	
    	msg = {
    			action: 'save_weekend',
    			days: days,
    			group_name: jQuery("#groups_select1").val()
    	};
    	XmppClient.send("queue", JSON.stringify(msg));
    }
    
    function _init(data){
        console.log('init admin');
    	jQuery("head").append(jQuery("<meta name='viewport' content='width=device-width, initial-scale=1.0'><link rel='stylesheet' href='stylesheets/normalize.css' /><link rel='stylesheet' href='stylesheets/app.css' /><link rel='stylesheet' href='stylesheets/foundation-datepicker.css'>"));
		document.title = 'CQ - Administrator';        
        
		_initData = data;
		_datadata = _initData;
		
        console.log (data);
    	location.href = "#!admin";
    	selectedGroup = _group;
    	console.log(selectedGroup);

    	if(data.lang){
        	_lang = data.lang;
       
        	var translated = "";
        	console.log("Lang: " + _lang);
        	
        	if(_lang=="kk"){
        		kk_ru = _kk;
        	}
        	else if(_lang=="ru"){
        		kk_ru = _ru;
        	}
        	else if(_lang=="en"){
        		kk_ru = _en;
        	}
    	}
    	
    	
    	
    	console.log("I am going to enter into data.weekends");
    	if(data.weekends){
    		console.log("I have entered data.weekends");
        	for(var i = 0; i < data.weekends.length; i++){
        		console.log("I am in first FOR");
        		console.log(data.weekends[i].group+" "+data.weekends[i].time);
    			for(var j = 0; j < data.groups.length; j++){
    				console.log("I am in second FOR");
    				if(data.groups[j].name == data.weekends[i].group){
    					console.log("I am in IF");
    					jQuery("#ol_list_holidays").append("<li id='weekend"+data.weekends[i].delete_id+"'>"+data.weekends[i].time+", "+data.groups[j].address+
    							" <a href='#' onclick='deleteHoliday("+data.weekends[i].delete_id+")'>Delete</a>"+"</li>");
    					break;
    				}
    			}
    		}
        }
    	
    	var Qname = new Array();
    	var html = "";
    	if(data.questions){
    		console.log(data.answers);
    		jQuery(data.questions).each(function(i){
    			var el = data.questions[i];
    			html += "<tr><td><a class='edit editQuestion' data-lane='"+el.id+"'>"+el.question+"</a></td></tr>";                                
            });
    		jQuery("#questions tbody").html(html);
        	/*
    		_count[count] = el.user;
        	_status[count] = "enabled";
        	console.log("EL.USER: " + _count[count] + ": " + count);
			_secondMonitor.push(el.user);
            var laneNames = "";
            jQuery(el.lanesRu).each(function(j){
                laneNames +=el.lanesRu[j]+",";
            });
            var tr = "<tr><td><a class='edit editSecondMonitor'>"+el.user+"</a></td>"+
                "<td><button class='btn btn-danger btn-medium disableUser' type='button' username='"+el.user+"'><p id='"+count+"'>"+kk_ru.disable+"</p></button></td></tr>";
            if(el.status=="DISABLED"){
                tr = tr.replace("disableUser","enableUser").replace(kk_ru.disable,kk_ru.enable).replace("danger","success");
                _status[count] = "disabled";
            }
            html.secondMonitor +=tr;
            */
        }
    	
    	jQuery(".settings").append(kk_ru.settings);
    	jQuery("#help").append(kk_ru.help);
    	jQuery("#logoutLink").append(kk_ru.quit);
    	jQuery(".lanes_label").append(kk_ru.lanes);
    	jQuery("#units_title").append(kk_ru.unitsTab);
    	jQuery("#dashboards_title").append(kk_ru.dashboardsTab);
    	jQuery("#second_monitor").append(kk_ru.modal.secondMonitor.title);
    	jQuery("#filials").append(kk_ru.filials);
    	jQuery("#lane").append(kk_ru.laneUsername);
    	jQuery("#startN").append(kk_ru.laneStartRange);
    	jQuery("#endN").append(kk_ru.laneEndRange);
    	jQuery("#color").append(kk_ru.laneColor);
    	jQuery("#priority").append(kk_ru.priority);
    	jQuery("#lane_priority").text(kk_ru.priority);
    	jQuery("#newLane").append(kk_ru.createLane);
    	jQuery("#kiosks_title").append(kk_ru.kiosksTab);
    	jQuery("#logos_title").append(kk_ru.logosTabHeader);
    	jQuery("#templates_title").append(kk_ru.templatesTab);
    	jQuery(".account").append(kk_ru.account);
    	jQuery(".question").text(kk_ru.question);
    	jQuery(".answer1").text(kk_ru.answer1);
    	jQuery(".answer2").text(kk_ru.answer2);
    	jQuery(".answer3").text(kk_ru.answer3);
    	jQuery(".answer4").text(kk_ru.answer4);
    	jQuery(".answer5").text(kk_ru.answer5);
    	jQuery("#unit_lanes").append(kk_ru.unitLanes);
    	jQuery("#newUnit").append(kk_ru.createUnit);
    	jQuery("#dashboard_lanes").append(kk_ru.dashboardLanes);
    	jQuery("#newDashboard").append(kk_ru.createDashboard);
    	jQuery("#newSecondMonitor").append(kk_ru.newSecondMonitor);
    	jQuery("#newKiosk").append(kk_ru.createKiosk);
    	jQuery("#newQuestion").text(kk_ru.createQuestion);
    	jQuery(".statistics").text(kk_ru.statistics);
    	jQuery("#statistics_title").text(kk_ru.statistics);
    	jQuery("#newStatistics").text(kk_ru.createStatistics);
    	jQuery("#logosButton").append(kk_ru.saveChanges);
    	jQuery("#templatesButton").append(kk_ru.saveChanges);
    	jQuery("#weekendsButton").append(kk_ru.saveChanges);
    	jQuery("#unit_title").append(kk_ru.unit+":");
    	jQuery("#unit_title1").append(kk_ru.unit+":");
    	jQuery("#kiosk_title").append(kk_ru.kiosk+":");
    	jQuery("#kiosk_title1").append(kk_ru.kiosk+":");
    	jQuery("#anketa_title").text(kk_ru.anketa+":");
    	jQuery("#ticket_title").append(kk_ru.ticket+":");
    	jQuery("#ticket_title1").append(kk_ru.ticket+":");
    	jQuery("#dashboard_title").append(kk_ru.dashboard+":");
    	jQuery("#dashboard_title1").append(kk_ru.dashboard+":");
    	jQuery("#weekends_title").append(kk_ru.weekends_title);
    	jQuery("#modal_lane_title").append(kk_ru.modal.lane.title);
    	jQuery("#modal_lane_header").append(kk_ru.modal.lane.header);
    	jQuery("#modal_quesiion_header").text(kk_ru.modal.anketa.header);
    	jQuery("#modal_question_title").text(kk_ru.modal.anketa.title);
    	jQuery(".username").append(kk_ru.username+":");
    	jQuery(".login_help").append(kk_ru.loginHelp);
    	jQuery("#lane_start_range").append(kk_ru.laneStartRange+":");
    	jQuery("#lane_end_range").append(kk_ru.laneEndRange+":");
    	jQuery("#lane_color").append(kk_ru.laneColor+":");
    	jQuery("#lane_ru").append(kk_ru.laneRU+":");
    	jQuery("#lane_kk").append(kk_ru.laneKK+":");
    	jQuery("#lane_en").append(kk_ru.laneEN+":");
    	jQuery(".close").append(kk_ru.close);
    	jQuery(".save").append(kk_ru.saveChanges);
    	jQuery("#modal_unit_title").append(kk_ru.modal.unit.title);
    	jQuery("#modal_unit_header").append(kk_ru.modal.unit.header);
    	jQuery(".password").append(kk_ru.password+":");
    	jQuery("#firstname").append(kk_ru.firstname+":");
    	jQuery("#last_name").append(kk_ru.lastname+":");
    	jQuery(".second_monitor").append(kk_ru.modal.secondMonitor.title);
    	jQuery("#lanes_title").append(kk_ru.lanes+":");
    	jQuery("#modal_dashboard_title").append(kk_ru.modal.dashboard.title);
    	jQuery("#modal_dashboard_header").append(kk_ru.modal.dashboard.header);
    	jQuery("#modal_secondMonitor_header").append(kk_ru.modal.secondMonitor.header);
    	jQuery("#modal_kiosk_title").append(kk_ru.modal.kiosk.title);
    	jQuery("#modal_kiosk_header1").append(kk_ru.modal.kiosk.header1);
    	jQuery("#main_lane_kk").append(kk_ru.mainLaneKK+":");
    	jQuery("#main_lane_ru").append(kk_ru.mainLaneRU+":");
    	jQuery("#createMainLaneBtn").append(kk_ru.create);
    	jQuery("#modal_kiosk_header2").append(kk_ru.modal.kiosk.header2);
    	jQuery("#main_lanes").append(kk_ru.mainLanes+":");
    	jQuery("#kiosk_help").append(kk_ru.kioskHelp);
    	jQuery("#list_of_holidays").append(kk_ru.list_of_holidays+":");
    	jQuery("#label_of_weekends").append(kk_ru.label_of_weekends+":");
    	jQuery("#weekendDaysButton").append(kk_ru.weekendDaysButton);
    	jQuery("#day1").append(kk_ru.days.d1);
    	jQuery("#day2").append(kk_ru.days.d2);
    	jQuery("#day3").append(kk_ru.days.d3);
    	jQuery("#day4").append(kk_ru.days.d4);
    	jQuery("#day5").append(kk_ru.days.d5);
    	jQuery("#day6").append(kk_ru.days.d6);
    	jQuery("#day7").append(kk_ru.days.d7);
    	
    	jQuery("#video_title").text(kk_ru.video_title);
    	jQuery("#play_video").text(kk_ru.play_video);
    	jQuery("#playLeft").text(kk_ru.playLeft);
    	jQuery("#playRight").text(kk_ru.playRight);
    	jQuery("#playAll").text(kk_ru.playAll);
    	jQuery("#stopLeft").text(kk_ru.stopLeft);
    	jQuery("#stopRight").text(kk_ru.stopRight);
    	jQuery("#stopAll").text(kk_ru.stopAll);
    	jQuery("#updateLink").text(kk_ru.updateLink);
    	jQuery("#add_running_line").text(kk_ru.runningLine);
    	
    	jQuery("#add_video_path").text(kk_ru.add_video_path);    	
    	XmppClient.send("queue",JSON.stringify({action:"loadGroup",group:_group}));
    	
        jQuery("#createMainLaneBtn").click(function(){
            jQuery("#modalKiosk table").append("<tr><td>"+
                jQuery("#mainlaneKK").val()+"</td><td>"+
                jQuery("#mainlaneRU").val()+"</td><td>"+
                jQuery("#modalKiosk select").val()+"</td><td><a href='#' class='deleteLink'>{{deleteLink}}</a></td></tr>");
            jQuery(".deleteLink").click(function(){
                jQuery(this).parent().parent().remove();
            });
            return false;
        });

        jQuery("#templatesButton").click(function(){
            var tplArr = new Array();
            jQuery("#templates textarea").each(function(){
                tplArr.push({data:jQuery(this).val(),role:jQuery(this).attr("id").replace("template","")});
            });
            XmppClient.send("queue",JSON.stringify({action:"admin",type:"updateTemplates",templates:tplArr,group:_group}));
        });

        jQuery("#logosButton").click(function(){
            XmppClient.send("queue",JSON.stringify({action:"admin",type:"updatePictures",kioskLogo:jQuery("#kioskLogo").val(),ticketLogo:jQuery("#ticketLogo").val(),dashboardLogo:jQuery("#dashboardLogo").val()}));
			return false;		
         });

        jQuery("#newLane").click(function(){
        	jQuery("#laneLogin").attr("disabled",false);
        	jQuery("#laneLogin").val('');
            jQuery("#laneColor").val('');
            jQuery("#lanePriority").val('');
            jQuery("#laneKK").val('');
            jQuery("#laneRU").val('');
            jQuery("#laneEn").val('');
            jQuery("#laneStartRange").val('');
            jQuery("#laneEndRange").val('');
            $('#modalLane').foundation('reveal','open');
            return false;
        });
        jQuery("#newUnit").click(function(){
            console.log('new unit');
			jQuery("select[class=lanes] option").removeAttr("selected");
            jQuery("#unitLogin").val('');
            jQuery("#unitLogin").attr("disabled",false);
            jQuery("#unitFirstname").val();
            jQuery("#unitLastname").val();
            jQuery("#unitWindow").val();
            $('#modalUnit').foundation('reveal','open');
            return false;
        });

        jQuery("#newDashboard").click(function(){
            jQuery("select[class=lanes] option").removeAttr("selected");
            jQuery("#dashboardLogin").val();
            jQuery("#dashboardLogin").attr("disabled",false);
            $('#modalDashboard').foundation('reveal','open');
            return false;
        });

        jQuery("#newSecondMonitor").click(function(){
        	jQuery("#modalsecondMonitor table").empty ();
        	jQuery("#secondmonitorLogin").val();
            jQuery("#secondmonitorLogin").attr("disabled",false);
            $('#modalSecondMonitor').foundation('reveal','open');
            return false;
        });

        jQuery("#newKiosk").click(function(){
            jQuery("#modalKiosk table").empty ();
        	jQuery("#kioskLogin").val();
            jQuery("#kioskLogin").attr("disabled",false);
            $('#modalKiosk').foundation('reveal','open');
            return false;
        });
        
        jQuery("#newStatistics").click(function(){
            console.log('new Statistics');
        	jQuery("#modalStatistics table").empty ();
        	jQuery("#statisticsLogin").val();
            $('#modalStatistics').foundation('reveal','open');
            return false;
        });
        
        jQuery("#newQuestion").click(function(){
        	jQuery("#question").val('');
        	jQuery("#answer1").val('');
        	jQuery("#answer2").val('');
        	jQuery("#answer3").val('');
        	jQuery("#answer4").val('');
        	jQuery("#answer5").val ();
            console.log('new Question');
        	$('#modalQuestion').foundation('reveal','open');
            return false;
        });
        
        jQuery(".modal").on("hide",function(){
            jQuery(".modal input").val("");
            jQuery("select[class=lanes] option").removeAttr("selected");
        });
        
        jQuery("#templates_title").click(function(){
            XmppClient.send("queue",JSON.stringify({action:"loadTemplates",group:_group}));
        });
    }

    function getUser(login){
        var result = null;
        jQuery(_users).each(function(i){
            if(_users[i].user==login){
                result = _users[i];
            }
        });
        return result;
    }

    function deleteHoliday(id_del){
    	console.log("Holiday is going to be deleted");
    	jQuery("#weekend"+id_del).remove();
        XmppClient.send("queue", JSON.stringify({action:"delete_holiday", id:id_del}));
    }
    
    function nvl(value,defaultValue){
        if(value==undefined || value==null){
            if(defaultValue){
                return defaultValue;
            }else{
                return "";
            }
        }
        return value;
    }

    function _onMessage(text){
        msg1 = {};
        try{
            msg1 = JSON.parse(text);
        }catch(e){
            console.log("admin got non-JSON message:"+text);
        }
        console.log(msg1);
        console.log(_group);

        if(msg1.username){
        	jQuery("#username").text(msg1.username);
        }
        
        if(msg1.groups && selectedGroup == _group){
            _groups = msg1.groups;
            jQuery('#customDropdown1').empty ();
			jQuery('#customDropdown1').append("<option DISABLED>"+kk_ru.chooseFilial+":</option>");
			jQuery(_groups).each(function(ix){
                var el = _groups[ix];          
                if(msg1.group == el.name){
                   	jQuery('#customDropdown1').append("<option selected='selected' value='"+el.name+"'>" + el.address + "</option>");
           		}else{
                	jQuery('#customDropdown1').append("<option value='"+el.name+"'>" + el.address + "</option>");
    		  	}
                jQuery("#groups_select").append('<option style="color:black;" value="' + el.name + '">' + el.address + '</option>');
                jQuery("#groups_select1").append('<option style="color:black;" value="' + el.name + '">' + el.address + '</option>');
			});

		}
        
    	if(msg1.questions){
    		var  html = "";
    		console.log(msg1.answers);
    		jQuery(msg1.questions).each(function(i){
    			var el = msg1.questions[i];
    			html += "<tr><td><a class='edit editQuestion' data-lane='"+el.id+"'>"+el.question+"</a></td></tr>";                                
            });
    		jQuery("#questions tbody").html(html);
        }
    	
    	if(msg1.weekends_days!=null){
    		if(msg1.weekends_days.length>0){
    			console.log("*************************************************");
    			console.log(jQuery("#groups_select1").val());
    			console.log("*************************************************");
    			_weekends_days = msg1.weekends_days;
    			for(var i = 1; i <= 7; i++){
    				for(var j = 0; j < _weekends_days.length; j++){
    					if(_weekends_days[j].days.indexOf(i)>-1 && _weekends_days[j].group == jQuery("#groups_select1").val()){
    						jQuery("#d"+i).prop('checked', true);
    					}
    				}
    			}
    		}
    	}
    	
    	if(msg1.saved_weekend){
    		getAllWeekends();
    	}
    	
    	$(".editQuestion").click(function(){
        	var questionId = $(this).attr("data-lane");
        	questionEdit = questionId;
            console.log (questionId);
            var answers = new Array("","","","","");
            var counter1 = 0;
            var counter2 = 0;
            var questionName = "";
            var f = false;
            $(msg1.questions).each(function(i){
            	var el = msg1.questions[i];
            	if(el.id==questionId){
            		questionName = el.question;
            		$(el.answersName).each(function(j){
            			var el1 = el.answersName[j];
            			answers[counter1++] = el1.Aname;
            		});
            		$(el.answersId).each(function(j){
            			var el1 = el.answersId[j];
            			answersId[counter2++] = el1.AId;
            		});
            	}
            });
            
            jQuery("#question").val(questionName);
            jQuery("#answer1").val(answers[0]);
            jQuery("#answer2").val(answers[1]);
            jQuery("#answer3").val(answers[2]);
            jQuery("#answer4").val(answers[3]);
            jQuery("#answer5").val(answers[4]);
            
            $('#modalQuestion').foundation('reveal','open');
            return false;
        });
        
    	if(msg1.last_item_name){
    		for(var j = 0; j < _groups.length; j++){
				console.log("I am in second FOR");
				if(_groups[j].name == msg1.last_item_name){
					console.log("I am in IF");
					jQuery("#ol_list_holidays").append("<li id='weekend"+msg1.last_item_id+"'>"+msg1.last_item_time + ", "+_groups[j].address+
							" <a href='#' onclick='deleteHoliday("+msg1.last_item_id+")'>Delete</a>"+"</li>");
					break;
				}
			}
    	}
    	
    	if(msg1.put_success){
    		getLastHoliday();
    	}
    	if(msg1.videoPath){
    		jQuery('#video_url').val(msg1.videoPath);
    	}
    	if(msg1.runningLine){
    		jQuery('#runningLine').val(msg1.runningLine);
    	}
    	
        if(msg1.users){
            //_initData = text;
            _secondMonitor = [];
            msg1.users.sort(function(a,b){
                return a.user.localeCompare(b.user);
            });
            _users = msg1.users;
            jQuery("select[class=lanes] option").remove();
            var html = {dashboard:"",unit:"",kiosk:"",lane:"",secondMonitor:"",statistics:""};
            var count = 0;
            jQuery(msg1.users).each(function(i){
            	var el = msg1.users[i];
                if(el.role=="UNIT"){
                	_count[count] = el.user;
                	_status[count] = "enabled";
                	console.log("EL.USER: " + _count[count] + ": " + count);
                	jQuery('#unitSecondMonitor').empty ();
        			var laneNames = "";
                    jQuery(el.lanesRu).each(function(j){
                    	laneNames +=el.lanesRu[j]+", ";
                    });
                    var tr = "<tr><td>"
                        +"<a class='edit editUnit' data-lane='"+el.user+"'>"+el.user+" ("+el.firstname+" "+el.lastname+")"+"</a></td><td>"+el.window+"</td><td>"
                        +laneNames.substring(0,laneNames.length-2)+"</td><td>"
                        +"<button class='btn btn-danger btn-medium disableUser' type='button' username='"+el.user+"'><p id='"+count+"'>"+kk_ru.disable+"</p></button>"
                        +"</td></tr>";
                    console.log(el.status);    
                    if(el.status=="DISABLED"){
                        tr = tr.replace("disableUser","enableUser").replace(kk_ru.disable,kk_ru.enable);
                        _status[count] = "disabled";
                        console.log(count+' '+kk_ru.enable)
                    }
                    html.unit +=tr;
                }else if(el.role=="DASHBOARD"){
                	_count[count] = el.user;
                	_status[count] = "enabled";
                	console.log("EL.USER: " + _count[count] + ": " + count);
                	var laneNames = "";
                    jQuery(el.lanesRu).each(function(j){
                        laneNames +=el.lanesRu[j]+",";
                    });
                    var tr = "<tr><td><a class='edit editDashboard'>"+el.user+"</a></td><td>"+laneNames.substring(0,laneNames.length-1)+"</td>"+
                        "<td><button class='btn btn-danger btn-medium disableUser' type='button' username='"+el.user+"'><p id='"+count+"'>"+kk_ru.disable+"</p></button></td></tr>";
                    if(el.status=="DISABLED"){
                        tr = tr.replace("disableUser","enableUser").replace(kk_ru.disable,kk_ru.enable).replace("danger","success");
                        _status[count] = "disabled";
                    }
                    html.dashboard +=tr;
                }else if(el.role=="SECOND_MONITOR"){
                	_count[count] = el.user;
                	_status[count] = "enabled";
                	console.log("EL.USER: " + _count[count] + ": " + count);
					_secondMonitor.push(el.user);
                    var laneNames = "";
                    jQuery(el.lanesRu).each(function(j){
                        laneNames +=el.lanesRu[j]+",";
                    });
                    var tr = "<tr><td><a class='edit editSecondMonitor'>"+el.user+"</a></td>"+
                        "<td><button class='btn btn-danger btn-medium disableUser' type='button' username='"+el.user+"'><p id='"+count+"'>"+kk_ru.disable+"</p></button></td></tr>";
                    if(el.status=="DISABLED"){
                        tr = tr.replace("disableUser","enableUser").replace(kk_ru.disable,kk_ru.enable).replace("danger","success");
                        _status[count] = "disabled";
                    }
                    html.secondMonitor +=tr;
                }else if(el.role=="KIOSK"){
                	_count[count] = el.user;
                	_status[count] = "enabled";
                	console.log("EL.USER: " + _count[count] + ": " + count);
                    var tr = "<tr><td><a class='edit editKiosk' data-lane='"+el.user+"'>"+el.user+"</a></td>"+
                        "<td><button class='btn btn-danger btn-medium disableUser' type='button' username='"+el.user+"'><p id='"+count+"'>"+kk_ru.disable+"</p></button></td></tr>";
                    if(el.status=="DISABLED"){
                        tr = tr.replace("disableUser","enableUser").replace(kk_ru.disable,kk_ru.enable).replace("danger","success");
                        _status[count] = "disabled";
                    }
                    html.kiosk +=tr;
                }else if(el.role=="MONITOR"){
                	_count[count] = el.user;
                	_status[count] = "enabled";
                	console.log("EL.USER: " + _count[count] + ": " + count);
                    var tr = "<tr><td><a class='edit editStatistics' data-lane='"+el.user+"'>"+el.user+"</a></td>"+
                        "<td><button class='btn btn-danger btn-medium disableUser' type='button' username='"+el.user+"'><p id='"+count+"'>"+kk_ru.disable+"</p></button></td></tr>";
                    if(el.status=="DISABLED"){
                        tr = tr.replace("disableUser","enableUser").replace(kk_ru.disable,kk_ru.enable).replace("danger","success");
                        _status[count] = "disabled";
                    }
                    html.statistics +=tr;
                }else if(el.role=="LANE"){
                	_count[count] = el.user;
                	_status[count] = "enabled";
                	console.log("EL.USER: " + _count[count] + ": " + count);
                    _lanes += el;
                    var tr = "<tr><td><a class='edit editLane' data-lane='"+el.user+"'>"+el.user+" ("+el.ru+")"+"</a></td>"+
                    "<td>"+nvl(el.startRange,0)+"</td>"+
                    "<td>"+nvl(el.endRange,0)+"</td>"+
                    "<td>"+nvl(el.color)+"</td>"+
                    "<td>"+nvl(el.priority)+"</td>"+
                    "<td><button class='btn btn-danger btn-medium disableUser' type='button' username='"+el.user+"'><p id='"+count+"'>"+kk_ru.disable+"</p></button></td></tr>";
                    if(el.status=="DISABLED"){
                        tr = tr.replace("disableUser","enableUser").replace(kk_ru.disable,kk_ru.enable).replace("danger","success");
                        jQuery("select[class=lanes]").append("<option disabled value='"+el.ru+"'>"+el.ru+"</option>");
                        _status[count] = "disabled";
                    }else{
                        jQuery("select[class=lanes]").append("<option value='"+el.ru+"'>"+el.ru+"</option>");
                    }
                    
                    html.lane +=tr;   
                }
                if(_count[count]!=null)
                	count++;
                
                jQuery("#units tbody").html(html.unit);
                jQuery("#kiosks tbody").html(html.kiosk);
                jQuery("#dashboards tbody").html(html.dashboard);
                jQuery("#secondMonitor tbody").html(html.secondMonitor);
                jQuery("#lanes tbody").html(html.lane);
                jQuery("#statistics tbody").html(html.statistics);


                jQuery(".edit").css("cursor","pointer");
            });

            jQuery(".editUnit").click(function(){
                jQuery("select[class=lanes] option").removeAttr("selected");
                var user = getUser(jQuery(this).attr("data-lane"));
                console.log (user);
                jQuery("#unitLogin").val(user.user);
                jQuery("#unitLogin").attr("disabled","");
                jQuery("#unitFirstname").val(user.firstname);
                jQuery("#unitLastname").val(user.lastname);
                jQuery("#unitWindow").val(user.window);
                jQuery(user.lanesRu).each(function(i){
                    jQuery("option[value='"+user.lanesRu[i]+"']").attr("selected","selected");
                });
                jQuery('#unitSecondMonitor').empty ();
                console.log(_users);
                
                jQuery('#unitSecondMonitor').append("<option value='null'>"+kk_ru.choose_second_monitor+":</option>");
    			    jQuery( _users).each(function(jx){
                        if(_users[jx].role == 'SECOND_MONITOR'){
                        	if(_users[jx].user == user.secondMonitor){
    							jQuery('#unitSecondMonitor').append("<option selected='selected' value='"+_users[jx].user+"'>" + _users[jx].user + "</option>");	
    						}else{
    							var f = false;
                                jQuery( _users).each(function(kx){
                                	if(_users[kx].role == 'UNIT'){
    						            if(_users[kx].secondMonitor == _users[jx].user){
        									f = true;
        								}
        							}
                                });
                                if(!f){
    								jQuery('#unitSecondMonitor').append("<option value='"+_users[jx].user+"'>" + _users[jx].user + "</option>");	
    	                        }
    						}								 
    					}
                    });

                $('#modalUnit').foundation('reveal','open');
                return false;
            });
            
            
            jQuery(".editLane").click(function(){
                var user = getUser(jQuery(this).attr("data-lane"));
                jQuery("#laneLogin").val(user.user);
                jQuery("#laneLogin").attr("disabled","");
                jQuery("#laneColor").val(user.color);
                jQuery("#laneKK").val(user.kk);
                jQuery("#lanePriority").val(user.priority);
                jQuery("#laneEN").val(user.en);
                jQuery("#laneRU").val(user.ru);
                jQuery("#laneStartRange").val(user.startRange);
                jQuery("#laneEndRange").val(user.endRange);
                $('#modalLane').foundation('reveal','open');

                return false;
            });

            jQuery(".editStatistics").click(function(){
                var user = getUser(jQuery(this).attr("data-lane"));
                jQuery("#statisticsLogin").val(user.user);
                jQuery("#statisticsLogin").attr("disabled","");
                $('#modalStatistics').foundation('reveal','open');
                return false;
            });
            
            jQuery(".editDashboard").click(function(){
                jQuery("select[class=lanes] option").removeAttr("selected");
                var user = getUser(jQuery(this).text());
                console.log (user);
                jQuery("#dashboardLogin").val(user.user);
                jQuery("#dashboardLogin").attr("disabled","");
                jQuery(user.lanesRu).each(function(i){
                    jQuery("option[value='"+user.lanesRu[i]+"']").attr("selected","selected");
                });
                $('#modalDashboard').foundation('reveal','open');
                return false;
            });

            jQuery(".editSecondMonitor").click(function(){
                var user = getUser(jQuery(this).text());
                console.log (user);
                jQuery("#secondmonitorLogin").val(user.user);
                jQuery("#secondmonitorLogin").attr("disabled","");
                $('#modalSecondMonitor').foundation('reveal','open');
                return false;
            });
            

            jQuery(".editKiosk").click(function(){
            	jQuery("#modalKiosk table").empty ();
            	console.log ('editKiosk');
            	var user = getUser(jQuery(this).attr("data-lane"));
            	console.log (user);
            	jQuery("#kioskLogin").val(user.user);
            	if(user.data){
                	var str = user.data.replace(/&(lt|gt|quot|apos);/g, function (m, p) { 
                        return (p == 'lt')? '<' : (p == 'gt') ? '>' : (p == 'apos' ? "'" : '"');
                    });
                    _laneTree = JSON.parse(str);
                    console.log (_laneTree);
                    jQuery(_laneTree).each(function(i){
                        var el1 = _laneTree[i];
                        var el = "";

                    	jQuery(el1.sublanes).each(function(j){
                    		jQuery(_users).each(function(k){
                                var user1 = _users[k];
                                if (user1.role == 'LANE'){
                                	console.log (user1);
                                    if(user1.user==el1.sublanes[j]){
                                    	el += user1.ru+",";
                                    }                               
                                }                                                       
                            });                        	                  	               
                        });   
                        console.log (el);
                    	jQuery("#modalKiosk table").append("<tr><td>"+
                                el1.kk+"</td><td>"+
                                el1.ru+"</td><td>"+
                                el.substring(0,el.length-1)+"</td><td><a href='#' class='deleteLink'>{{deleteLink}}</a></td></tr>");
                    	jQuery(".deleteLink").click(function(){
                            jQuery(this).parent().parent().remove();
                        });
                    });
            	}
                jQuery("#kioskLogin").attr("disabled","");
                $('#modalKiosk').foundation('reveal','open');
            });

            jQuery(".enableUser").click(function(){
                XmppClient.send("queue",JSON.stringify({action:"admin",type:"enableUser",
                    username:jQuery(this).attr("username"),
                    group:_group}));
            });

            jQuery(".disableUser").click(function(){
            	console.log('disable user');
                XmppClient.send("queue",JSON.stringify({action:"admin",type:"disableUser",
                    username:jQuery(this).attr("username"),
                    group:_group}));
            });
            

            jQuery("#kioskLogo").val(msg1.kioskLogo);
            jQuery("#dashboardLogo").val(msg1.dashboardLogo);
            jQuery("#ticketLogo").val(msg1.ticketLogo);
        }
        
        if(msg1.result && msg1.result=="success"){
            console.log(_group);
            XmppClient.send("queue",JSON.stringify({action:"loadGroup",group:selectedGroup}));
        }
        
        if(msg1.templates){
            jQuery(msg1.templates).each(function(ix){
                var t = msg1.templates[ix].html.replace(/&(lt|gt|quot|apos);/g, function (m, p) { 
                    return (p == 'lt')? '<' : (p == 'gt') ? '>' : (p == 'apos' ? "'" : '"');
                });
                jQuery("#template"+msg1.templates[ix].role).val(t);
            });
        }
    }
    
    function saveVideoUrl(){
    	console.log('save video url');
    	var path = $('#video_url').val();
    	if(path != ''){
    		XmppClient.send("queue",JSON.stringify({action:"saveVideoPath",videoPath:path,group:selectedGroup}));	
    	}    	 
    }
    
    function saveRunningLine(){
    	console.log('save ruuning line');
    	var line = $('#runningLine').val();
    	if(line != ''){
    		XmppClient.send("queue",JSON.stringify({action:"saveRunningLine",runningLine:line,group:selectedGroup}));	
    	}    	 
    }
    
    function goToFilial() {
        group = jQuery('#customDropdown1').val();
        XmppClient.send("queue",JSON.stringify({action:"loadGroup",group:group}));        
    }
    
    function getAllWeekends(){
    	XmppClient.send("queue", JSON.stringify({action:"get_all_weekends"}));
    }
    
    function getLastHoliday(){
    	XmppClient.send("queue", JSON.stringify({action:"get_last_item"}));
    }
    function reklamaLeftPlay(){
    	XmppClient.send("queue", JSON.stringify({action:"reklamaLeftPlay",group:selectedGroup}));
    }
    function reklamaRightPlay(){
    	XmppClient.send("queue", JSON.stringify({action:"reklamaRightPlay",group:selectedGroup}));
    }
    function videoPlay(){
    	XmppClient.send("queue", JSON.stringify({action:"videoPlay",group:selectedGroup}));
    }
    function reklamaLeftStop(){
    	XmppClient.send("queue", JSON.stringify({action:"reklamaLeftStop",group:selectedGroup}));
    }
    function reklamaRightStop(){
    	XmppClient.send("queue", JSON.stringify({action:"reklamaRightStop",group:selectedGroup}));
    }
    function videoStop(){
    	XmppClient.send("queue", JSON.stringify({action:"videoStop",group:selectedGroup}));
    }
    function getSettings(){
		jQuery('#messageBody').html(
				'<p>'+kk_ru.choose_lang+'</p>' +
				'<label for="ru_lang"><input type="radio" id="ru_lang" name="lang" value="ru" />Русский</label>' +
				'<label for="kk_lang"><input type="radio" id="kk_lang" name="lang" value="kk" />Казахский</label>' +
				'<label for="en_lang"><input type="radio" id="en_lang" name="lang" value="en" />English</label>');
		$('#message').foundation('reveal','open');
     //   jQuery('#dropdown_menu').hide();
	}
    
    function change_checkers(){
    	for(var i = 1; i <= 7; i++){
			jQuery("#d"+i).prop('checked', false);
		}
    	if(_weekends_days!=null){
    		for(var i = 1; i <= 7; i++){
    			for(var j = 0; j < _weekends_days.length; j++){
    				if(_weekends_days[j].days.indexOf(i)>-1 && _weekends_days[j].group == jQuery("#groups_select1").val()){
    					jQuery("#d"+i).prop('checked', true);
    				}
    			}
    		}
    	}
    }
    
    function change_lang(){
		var inputs = document.getElementsByName("lang");
        for (var i = 0; i < inputs.length; i++) {
          if (inputs[i].checked) {
            _lang = inputs[i].value;
          }
        }
        
        if(_lang=="kk"){
    		kk_ru = _kk;
    	}
    	else if(_lang=="ru"){
    		kk_ru = _ru;
    	}
    	else if(_lang=="en"){
    		kk_ru = _en
    	}
        jQuery("#help").empty();
        jQuery('#help').append(kk_ru.help);
        jQuery(".settings").empty();
    	jQuery(".settings").append(kk_ru.settings);
    	jQuery("#logoutLink").empty();
    	jQuery("#logoutLink").append(kk_ru.quit);
    	jQuery(".lanes_label").empty();
    	jQuery(".lanes_label").append(kk_ru.lanes);
    	jQuery("#units_title").empty();
    	jQuery("#units_title").append(kk_ru.unitsTab);
    	jQuery("#dashboards_title").empty();
    	jQuery("#dashboards_title").append(kk_ru.dashboardsTab);
    	jQuery("#second_monitor").empty();
    	jQuery("#second_monitor").append(kk_ru.modal.secondMonitor.title);
    	jQuery("#filials").empty();
    	jQuery("#filials").append(kk_ru.filials);
    	jQuery("#lane").empty();
    	jQuery("#lane").append(kk_ru.laneUsername);
    	jQuery("#startN").empty();
    	jQuery("#startN").append(kk_ru.laneStartRange);
    	jQuery("#endN").empty();
    	jQuery("#endN").append(kk_ru.laneEndRange);
    	jQuery("#color").empty();
    	jQuery("#color").append(kk_ru.laneColor);
    	jQuery("#priority").text(kk_ru.priority);
    	jQuery("#lane_priority").text(kk_ru.priority);
    	jQuery("#newLane").empty();
    	jQuery("#newLane").append(kk_ru.createLane);
    	jQuery("#kiosks_title").empty();
    	jQuery("#kiosks_title").append(kk_ru.kiosksTab);
    	jQuery("#logos_title").empty();
    	jQuery("#logos_title").append(kk_ru.logosTabHeader);
    	jQuery("#anketa_title").text(kk_ru.anketaTabHeader);
    	
    	jQuery("#templates_title").empty();
    	jQuery("#templates_title").append(kk_ru.templatesTab);
    	jQuery("#weekends_title").empty();
    	jQuery("#weekends_title").append(kk_ru.weekends_title);
    	jQuery(".account").empty();
    	jQuery(".account").append(kk_ru.account);
    	jQuery(".question").append(kk_ru.question);
    	jQuery(".answer1").append(kk_ru.answer1);
    	jQuery(".answer2").append(kk_ru.answer2);
    	jQuery(".answer3").append(kk_ru.answer3);
    	jQuery(".answer4").append(kk_ru.answer4);
    	jQuery(".answer5").append(kk_ru.answer5);
    	jQuery("#kiosk_title").empty();
    	jQuery("#kiosk_title").append(kk_ru.kiosk+":");
    	jQuery("#kiosk_title1").empty();
    	jQuery("#kiosk_title1").append(kk_ru.kiosk+":");
    	jQuery("#unit_lanes").empty();
    	jQuery("#unit_lanes").append(kk_ru.unitLanes);
    	jQuery("#newUnit").empty();
    	jQuery("#newUnit").append(kk_ru.createUnit);
    	jQuery("#dashboard_lanes").empty();
    	jQuery("#dashboard_lanes").append(kk_ru.dashboardLanes);
    	jQuery("#newDashboard").empty();
    	jQuery("#newDashboard").append(kk_ru.createDashboard);
    	jQuery("#newSecondMonitor").empty();
    	jQuery("#newSecondMonitor").append(kk_ru.newSecondMonitor);
    	jQuery("#newKiosk").empty();
    	jQuery("#newKiosk").append(kk_ru.createKiosk);
    	jQuery("#newQuestion").append(kk_ru.createQuestion);
    	jQuery("#ticket_title").empty();
    	jQuery("#ticket_title").append(kk_ru.ticket+":");
    	jQuery("#dashboard_title").empty();
    	jQuery("#dashboard_title").append(kk_ru+":");
    	jQuery("#dashboard_title1").empty();
    	jQuery("#dashboard_title1").append(kk_ru.dashboard+":");
    	jQuery("#logosButton").empty();
    	jQuery("#logosButton").append(kk_ru.saveChanges);
    	jQuery("#templatesButton").empty();
    	jQuery("#templatesButton").append(kk_ru.saveChanges);
    	jQuery("#weekendsButton").empty();
    	jQuery("#weekendsButton").append(kk_ru.saveChanges);
    	jQuery("#unit_title1").empty();
    	jQuery("#unit_title1").append(kk_ru.unit+":");
    	jQuery("#modal_lane_title").empty();
    	jQuery("#modal_lane_title").append(kk_ru.modal.lane.title);
    	jQuery("#modal_lane_header").empty();
    	jQuery("#modal_lane_header").append(kk_ru.modal.lane.header);
    	jQuery("#modal_quesiion_header").text(kk_ru.modal.anketa.header);    		
    	jQuery("#modal_question_title").text(kk_ru.modal.anketa.title);
    	jQuery(".username").empty();
    	jQuery(".username").append(kk_ru.username+":");
    	jQuery(".login_help").empty();
    	jQuery(".login_help").append(kk_ru.loginHelp);
    	jQuery("#lane_start_range").empty();
    	jQuery("#lane_start_range").append(kk_ru.laneStartRange+":");
    	jQuery("#lane_end_range").empty();
    	jQuery("#lane_end_range").append(kk_ru.laneEndRange+":");
    	jQuery("#lane_color").empty();
    	jQuery("#lane_color").append(kk_ru.laneColor+":");
    	jQuery("#lane_ru").empty();
    	jQuery("#lane_ru").append(kk_ru.laneRU+":");
    	jQuery("#lane_kk").empty();
    	jQuery("#lane_kk").append(kk_ru.laneKK+":");
    	jQuery("#lane_en").empty();
    	jQuery("#lane_en").append(kk_ru.laneEN+":");
    	jQuery(".close").empty();
    	jQuery(".close").append(kk_ru.close);
    	jQuery(".save").empty();
    	jQuery(".save").append(kk_ru.saveChanges);
    	jQuery("#modal_unit_title").empty();
    	jQuery("#modal_unit_title").append(kk_ru.modal.unit.title);
    	jQuery("#modal_unit_header").empty();
    	jQuery("#modal_unit_header").append(kk_ru.modal.unit.header);
    	jQuery(".password").empty();
    	jQuery(".password").append(kk_ru.password+":");
    	jQuery("#firstname").empty();
    	jQuery("#firstname").append(kk_ru.firstname+":");
    	jQuery("#last_name").empty();
    	jQuery("#last_name").append(kk_ru.lastname+":");
    	jQuery(".second_monitor").empty();
    	jQuery(".second_monitor").append(kk_ru.modal.secondMonitor.title);
    	jQuery("#lanes_title").empty();
    	jQuery("#lanes_title").append(kk_ru.lanes+":");
    	jQuery("#modal_dashboard_title").empty();
    	jQuery("#modal_dashboard_title").append(kk_ru.modal.dashboard.title);
    	jQuery("#modal_dashboard_header").empty();
    	jQuery("#modal_dashboard_header").append(kk_ru.modal.dashboard.header);
    	jQuery("#modal_secondMonitor_header").empty();
    	jQuery("#modal_secondMonitor_header").append(kk_ru.modal.secondMonitor.header);
    	jQuery("#modal_kiosk_title").empty();
    	jQuery("#modal_kiosk_title").append(kk_ru.modal.kiosk.title);
    	jQuery("#modal_kiosk_header1").empty();
    	jQuery("#modal_kiosk_header1").append(kk_ru.modal.kiosk.header1);
    	jQuery("#main_lane_kk").empty();
    	jQuery("#main_lane_kk").append(kk_ru.mainLaneKK+":");
    	jQuery("#main_lane_ru").empty();
    	jQuery("#main_lane_ru").append(kk_ru.mainLaneRU+":");
    	jQuery("#createMainLaneBtn").empty();
    	jQuery("#createMainLaneBtn").append(kk_ru.create);
    	jQuery("#modal_kiosk_header2").empty();
    	jQuery("#modal_kiosk_header2").append(kk_ru.modal.kiosk.header2);
    	jQuery("#main_lanes").empty();
    	jQuery("#main_lanes").append(kk_ru.mainLanes+":");
    	jQuery("#kiosk_help").empty();
    	jQuery("#kiosk_help").append(kk_ru.kioskHelp);
    	jQuery("#list_of_holidays").empty();
    	jQuery("#list_of_holidays").append(kk_ru.list_of_holidays+":");
    	jQuery("#label_of_weekends").empty();
    	jQuery("#label_of_weekends").append(kk_ru.label_of_weekends+":");
    	jQuery("#weekendDaysButton").empty();
    	jQuery("#weekendDaysButton").append(kk_ru.weekendDaysButton);
    	jQuery("#day1").empty();
    	jQuery("#day1").append('<input id="d1" type="checkbox" name="weekend" value="1"></input>'+kk_ru.days.d1);
    	jQuery("#day2").empty();
    	jQuery("#day2").append('<input id="d2" type="checkbox" name="weekend" value="2"></input>'+kk_ru.days.d2);
    	jQuery("#day3").empty();
    	jQuery("#day3").append('<input id="d3" type="checkbox" name="weekend" value="3"></input>'+kk_ru.days.d3);
    	jQuery("#day4").empty();
    	jQuery("#day4").append('<input id="d4" type="checkbox" name="weekend" value="4"></input>'+kk_ru.days.d4);
    	jQuery("#day5").empty();
    	jQuery("#day5").append('<input id="d5" type="checkbox" name="weekend" value="5"></input>'+kk_ru.days.d5);
    	jQuery("#day6").empty();
    	jQuery("#day6").append('<input id="d6" type="checkbox" name="weekend" value="6"></input>'+kk_ru.days.d6);
    	jQuery("#day7").empty();
    	jQuery("#day7").append('<input id="d7" type="checkbox" name="weekend" value="7"></input>'+kk_ru.days.d7);
    	
    	for(var i = 0; i < _count.length; i++){
    		jQuery("#"+i).empty();
    		if(_status[i]=="disabled")
    			jQuery("#"+i).append(kk_ru.enable);
    		else
    			jQuery("#"+i).append(kk_ru.disable);
    	}
    	        
        console.log("LANGUAGE IS: " + _lang);
        $('#message').foundation('reveal','close');
		XmppClient.send("queue", JSON.stringify({action:"changeLang", user:sessionStorage.jid, language:_lang}));
		//locale(_lang);
	}
    
    jQuery("#logoutLink").click(function(){
    	console.log("logoutLink was clicked");
    	window.location = "/";
        sessionStorage.clear();
        XmppClient.connection.disconnect();
     //   jQuery("#loginPanel").show();
     //   jQuery("#userPanel").hide();
    });

    
    jQuery(document).ready(function(){
		$(function() {
			window.prettyPrint && prettyPrint();
			$('#dp1').fdatepicker({
				format: 'mm-dd-yyyy'
			});
			$('#dp2').fdatepicker({
				closeButton: true
			});
			var nowTemp = new Date();
			var now = new Date(nowTemp.getFullYear(), nowTemp.getMonth(), nowTemp.getDate(), 0, 0, 0, 0);
			$('#dp3').fdatepicker({
				onRender: function (date) {
					return date.valueOf() < now.valueOf() ? 'disabled' : '';
				}
			});
			$('#dp-margin').fdatepicker();
			$('#dpYears').fdatepicker();
			$('#dpMonths').fdatepicker();
			var startDate = new Date(2012, 1, 20);
			var endDate = new Date(2012, 1, 25);
			$('#dp4').fdatepicker()
				.on('changeDate', function (ev) {
				if (ev.date.valueOf() > endDate.valueOf()) {
					$('#alert').show().find('strong').text('The start date can not be greater then the end date');
				} else {
					$('#alert').hide();
					startDate = new Date(ev.date);
					$('#startDate').text($('#dp4').data('date'));
				}
				$('#dp4').fdatepicker('hide');
			});
			$('#dp5').fdatepicker()
				.on('changeDate', function (ev) {
				if (ev.date.valueOf() < startDate.valueOf()) {
					$('#alert').show().find('strong').text('The end date can not be less then the start date');
				} else {
					$('#alert').hide();
					endDate = new Date(ev.date);
					$('#endDate').text($('#dp5').data('date'));
				}
				$('#dp5').fdatepicker('hide');
			});
			// implementation of disabled form fields
			var nowTemp = new Date();
			var now = new Date(nowTemp.getFullYear(), nowTemp.getMonth(), nowTemp.getDate(), 0, 0, 0, 0);
			var checkin = $('#dpd1').fdatepicker({
				onRender: function (date) {
					return date.valueOf() < now.valueOf() ? 'disabled' : '';
				}
			}).on('changeDate', function (ev) {
				if (ev.date.valueOf() > checkout.date.valueOf()) {
					var newDate = new Date(ev.date)
					newDate.setDate(newDate.getDate() + 1);
					checkout.setValue(newDate);
				}
				checkin.hide();
				$('#dpd2')[0].focus();
			}).data('datepicker');
			var checkout = $('#dpd2').fdatepicker({
				onRender: function (date) {
					return date.valueOf() <= checkin.date.valueOf() ? 'disabled' : '';
				}
			}).on('changeDate', function (ev) {
				checkout.hide();
			}).data('datepicker');
		});
});
