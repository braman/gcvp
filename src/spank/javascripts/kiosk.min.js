function toggleLaneType(e){kiosk_services=$("#kiosk-services a");IDlaneTypeName=$("#"+e);var t=IDlaneTypeName;t.toggleClass("active");t.find(".tick-pic, figure").fadeToggle(99);if(lanes.indexOf(e+";")>=0){lanes=lanes.replace(e+";","")}else{lanes+=e+";"}clearLanes();var n=lanes.split(";");var r=0;jQuery(n).each(function(e){r++;jQuery("#laneNumber"+n[e]).text(r);jQuery("#laneNumber"+n[e]).show()});console.log(r);if(r==1){print_services.fadeOut()}else{print_services.fadeIn()}}function _initFromLang(e,t){console.log("lang");$lanes.empty();_data=e;_lang=t;$(_lanes).each(function(e){var t=_lanes[e];if(_lang=="en-lang"){$lanes.append("<li><a id='"+t.id+"' class='kiosk-link block' href='#' onclick=\" toggleLaneType('"+t.id+"')\">"+"<div class='tick-pic ui-tick'></div><span>"+t.en+"</span><figure style='display:none' id='laneNumber"+t.id+"'></figure></a></li>")}else if(_lang=="kk-lang"){$lanes.append("<li><a id='"+t.id+"' class='kiosk-link block' href='#' onclick=\" toggleLaneType('"+t.id+"')\">"+"<div class='tick-pic ui-tick'></div><span>"+t.kk+"</span><figure style='display:none' id='laneNumber"+t.id+"'></figure></a></li>")}else{$lanes.append("<li><a id='"+t.id+"' class='kiosk-link block' href='#' onclick=\" toggleLaneType('"+t.id+"')\">"+"<div class='tick-pic ui-tick'></div><span>"+t.ru+"</span><figure style='display:none' id='laneNumber"+t.id+"'></figure></a></li>")}});setTimeout(function(){$("#kiosk-step-2").hide();$("#kiosk-step-3").hide();$("#kiosk-step-iin").hide();$("#kiosk-step-1").show()},12e4);if(_lang=="kk-lang"){kk_ru=_kk}else if(_lang=="ru-lang"){kk_ru=_ru}else if(_lang=="en-lang"){kk_ru=_en}$("#reservation_title").text(kk_ru.reservation_title);$("#yes").text(kk_ru.yes);$("#no").text(kk_ru.no);$("#kiosk-backspace").text(kk_ru.kiosk_backspace);$("#attention").text(kk_ru.attention);$("#lead").text(kk_ru.lead);$("#kiosk-iin-input")[0].placeholder=kk_ru.kiosk_iin_input}function cleariin(){print_iin.fadeOut();$("#kiosk-iin-input").empty()}function clearAll(){clearLanes();cleariin();clearActiveLanes()}function clearActiveLanes(){print_services.fadeOut();lanes="";jQuery(_lanes).each(function(e){jQuery("#"+_lanes[e].id).removeClass("active");jQuery("#"+_lanes[e].id).find(".tick-pic, figure").hide()});clearLanes()}function clearLanes(){jQuery(_lanes).each(function(e){jQuery("#laneNumber"+_lanes[e].id).empty();jQuery("#laneNumber"+_lanes[e].id).hide()})}function _init(e){console.log("init");_data=e;if(e.lanes){_lanes=e.lanes;console.log(_lanes)}if(e.group){_group=e.group}if(e.reservations){_reservations=e.reservations}iinFake=$("#kiosk-iin-input");$("#kk-lang").click(function(){_initFromLang(e,"kk-lang");step1.fadeOut(300,function(){step2.fadeIn(300)})});$("#ru-lang").click(function(){_initFromLang(e,"ru-lang");step1.fadeOut(300,function(){step2.fadeIn(300)})});$("#en-lang").click(function(){_initFromLang(e,"en-lang");step1.fadeOut(300,function(){step2.fadeIn(300)})});console.log("head_---------------------------------------");jQuery("head").empty();document.title="Киоск CloudQueue";jQuery("head").append(jQuery("<meta charset='utf8'><meta content='width=device-width' name='viewport'><link href='stylesheets/kiosk.css' media='print,screen' rel='stylesheet'><link href='http://fonts.googleapis.com/css?family=Ubuntu&subset=latin,cyrillic' rel='stylesheet' type='text/css'>"))}function getLane(e){var t=null;$(_lanes).each(function(n){var r=_lanes[n];if(r.id==e){t=r}});return t}function bot(){_bot=true;setInterval(function(){var e=parseInt(Math.random()*1e5);if(e>5e4){setTimeout(function(){$("#ru-lang").click();console.log("ru-lang")},2500);setTimeout(function(){$("#no").click();console.log("no")},5e3);if(e>7e4){if(e>9e4){setTimeout(function(){$("#a").click();console.log("a")},7500)}else if(e>8e4){setTimeout(function(){$("#b").click();console.log("b")},7500)}else if(e>7e4){setTimeout(function(){$("#g").click();console.log("g")},7500)}}else if(e>6e4){if(e>66e3){setTimeout(function(){$("#a").click();$("#b").click();console.log("ab")},7500)}else if(e>63e3){setTimeout(function(){$("#b").click();$("#q").click();console.log("bg")},7500)}else if(e>6e4){setTimeout(function(){$("#g").click();$("#a").click();console.log("ga")},7500)}}else{setTimeout(function(){$("#a").click();$("#b").click();$("#g").click();console.log("abg")},7500)}setTimeout(function(){$("#kiosk-print-services").click();console.log("kiosk-print-services")},1e4)}else if(r<3e4){setTimeout(function(){$("#kk-lang").click();console.log("ru-lang")},2500);setTimeout(function(){$("#no").click();console.log("no")},5e3);if(e>7e4){if(e>9e4){setTimeout(function(){$("#a").click();console.log("a")},7500)}else if(e>8e4){setTimeout(function(){$("#b").click();console.log("b")},7500)}else if(e>7e4){setTimeout(function(){$("#g").click();console.log("g")},7500)}}else if(e>6e4){if(e>66e3){setTimeout(function(){$("#a").click();$("#b").click();console.log("ab")},7500)}else if(e>63e3){setTimeout(function(){$("#b").click();$("#q").click();console.log("bg")},7500)}else if(e>6e4){setTimeout(function(){$("#g").click();$("#a").click();console.log("ga")},7500)}}else{setTimeout(function(){$("#a").click();$("#b").click();$("#g").click();console.log("abg")},7500)}setTimeout(function(){$("#kiosk-print-services").click();console.log("kiosk-print-services")},1e4)}else{setTimeout(function(){$("#en-lang").click();console.log("ru-lang")},2500);setTimeout(function(){$("#no").click();console.log("no")},5e3);if(e>7e4){if(e>9e4){setTimeout(function(){$("#a").click();console.log("a")},7500)}else if(e>8e4){setTimeout(function(){$("#b").click();console.log("b")},7500)}else if(e>7e4){setTimeout(function(){$("#g").click();console.log("g")},7500)}}else if(e>6e4){if(e>66e3){setTimeout(function(){$("#a").click();$("#b").click();console.log("ab")},7500)}else if(e>63e3){setTimeout(function(){$("#b").click();$("#q").click();console.log("bg")},7500)}else if(e>6e4){setTimeout(function(){$("#g").click();$("#a").click();console.log("ga")},7500)}}else{setTimeout(function(){$("#a").click();$("#b").click();$("#g").click();console.log("abg")},7500)}setTimeout(function(){$("#kiosk-print-services").click();console.log("kiosk-print-services")},1e4)}},15e3)}function _onMessage(e){console.log("_onMessage:"+e);var t={};try{t=JSON.parse(e)}catch(n){console.warn("Kiosk got non-JSON message:"+e)}console.log(t);if(t.ticket){$("#ticketCode").text(t.ticket.code);var r=iinFake.text();if(r.length==0){r="000000000000"}if(r!="000000000000"){$("#clientIdMessage").text("ID:");$("#clientId").text(r);$("#cli").show()}else{$("#cli").hide()}$("#ticketCreateDateMessage").text(kk_ru.ticketCreateDateMessage);var i=new Date;$("#ticketCreateDate").text(i.toJSON().split("T")[0]+" "+i.toTimeString().split(" ")[0]);$("#laneTypesMessage").text(kk_ru.laneTypesMessage);var s="";$(t.ticket.lanes).each(function(e){if(t.ticket.lanes[e].length>0){var n=t.ticket.lanes[e];var r=0;for(var i in _lanes){lane=_lanes[i];if(lane.id==getLane(n).id){if(t.ticket.isReserved)r=lane.reserved-1;else r=lane.count+lane.reserved-1}}if(_lang=="en-lang"){s+=getLane(n).en+" ("+r+")"+","}else if(_lang=="kk-lang"){s+=getLane(n).kk+" ("+r+")"+","}else{s+=getLane(n).ru+" ("+r+")"+","}}});s=s.substr(0,s.length-1);console.log(s);$("#laneTypes").text(s+"");var o=0;$(t.ticket.lanes).each(function(e){var n=t.ticket.lanes[e];$(_lanes).each(function(e){var r=_lanes[e];if(r.id==n){console.log(r.count+" / "+r.reserved);if(t.ticket.isReserved){o=o+r.reserved-1;var i=-1;for(var s in _reservations){var u=_reservations[s];if(u.id==t.ticket.clientIin&&t.ticket.clientIin!=undefined){i=s;break}}if(i!=-1)_reservations.splice(i,1)}else o=o+r.count+r.reserved-1}})});$("#waitingClientsPrintMessage").text(kk_ru.waitingClientsPrintMessage+o);window.print();$("#kiosk-step-2").hide();$("#kiosk-step-3").hide();setTimeout(function(){$("#kiosk-step-1").show()},500)}else if(t.pubsub){console.log("**** PUBSUB ****");console.log(t);$(t.lanes).each(function(e){var n=t.lanes[e];$(_lanes).each(function(e){var t=_lanes[e];if(t.id==n.id){t.count=n.count;t.reserved=n.reserved;_lanes[e]=t}})});if(t.reservation){_reservations.push(t.reservation)}}}function onConnect(){firstTime++;setTimeout(function(){$(".panel").fadeIn("slow");nextScene("lanes")},600);console.log(XmppClient.connection.sid)}function _onStatus(e){if(e=="CONNECTED"||e=="ATTACHED"){onConnect()}if(e=="DISCONNECTED"){$(".panel").fadeOut("slow")}}function printTicket(){console.log("print ticket");if(iinFake.text()==""){if(lanes&&lanes.length>0){console.log("enqueue print");enqueue(_lang)}}else{_reservations.forEach(function(t){if(t.id==iinFake.text()){console.log(t.id+" found");iin=$("#kiosk-iin-input").text();e=true}});var e=false;$(_reservations).each(function(t){var n=_reservations[t];if(n.id.toLowerCase()==iinFake.text().toLowerCase()){var r={};var i=n.date.split(" ");var s=i[0].split(".");console.log("rDateArr "+s);var o=i[1].split(":");r.date=Number(s[0]);r.month=Number(s[1]);r.hour=Number(o[0]);r.minute=Number(o[1]);var u=new Date;var a=new Date;a.setDate(Number(s[0]));a.setMonth(Number(s[1])-1);a.setHours(Number(o[0]));a.setMinutes(Number(o[1]));u.setMinutes(u.getMinutes()<30?0:30);if(a.getTime()==u.getTime()){$(n.lanes).each(function(e){toggleLaneType(n.lanes[e])})}else{}e=true}});if(!e){console.log("reser not ");if(firstTime==0){jQuery("body").append(jQuery("<script src='javascripts/jquery.reveal.js'></script"))}if(length<13){print_iin.fadeOut()}$("div#attention_modal").reveal()}}clearAll()}function enqueue(e){var t=iin;console.log(t);if(t==null){t="000000000000"}var n=lanes.split(";");var r=new Array;$(n).each(function(e){if(n[e]!=""&&n[e].length!=0){r.push(n[e])}});var i={action:"enqueue",lang:e,client:t,lanes:r};console.log("123123");console.log(i);XmppClient.send("queue",JSON.stringify(i))}var _ru={reservation_title:"Бронировали ли вы очередь?",yes:"Да",kiosk_backspace:"Удалить",attention:"Внимание!",lead:"Вашего ИИН не оказалось в нашей базе. Проверьте правильно ли введен номер.",kiosk_iin_input:"Введите ваш ИИН",ticketCreateDateMessage:"Время:",laneTypesMessage:"Услуги:",waitingClientsPrintMessage:"Количество клиентов перед Вами: ",no:"Нет"};var _en={reservation_title:"Did you reserve the ticket?",yes:"Yes",kiosk_backspace:"Clear",attention:"Attention!",lead:"Your IIN wasn't found. Check the number",kiosk_iin_input:"Write your IIN",ticketCreateDateMessage:"Time ",laneTypesMessage:"Services ",waitingClientsPrintMessage:"Number of clients before you: ",no:"No"};var _kk={reservation_title:"Бронь арқылы ма?",yes:"Иә",kiosk_backspace:"Жою",attention:"Назар аударыңыз!",lead:"Сіздің ЖСН базадан табылмады. Нөмеріңіздің нақты дұрыс екенін тексеріңіз",kiosk_iin_input:"ЖСН енгізіңіз",ticketCreateDateMessage:"Уақыт",laneTypesMessage:"Қызметтер",waitingClientsPrintMessage:"Сіздің алдыңыздағы клиент саны: ",no:"Жоқ"};var iinFake,iin=null,lanes="",$lanes=$("#kiosk-services"),_lanes=null,_reservations=new Array,_laneTree=null,_group={},_lang=null,_data=null;var firstTime=0