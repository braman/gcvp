function toggleLaneType(e){kiosk_services=$("#kiosk-services a");IDlaneTypeName=$("#"+e);var t=IDlaneTypeName;t.toggleClass("active");t.find(".tick-pic, figure").fadeToggle(99);if(lanes.indexOf(e+";")>=0){lanes=lanes.replace(e+";","")}else{lanes+=e+";"}clearLanes();var n=lanes.split(";");var r=0;printTicket()}function _initFromLang(e,t){console.log("lang");$lanes.empty();_data=e;_lang=t;if(jQuery.type(e.tree)==="string"){laneGroup=true;var n=e.tree.replace(/&(lt|gt|quot|apos);/g,function(e,t){return t=="lt"?"<":t=="gt"?">":t=="apos"?"'":'"'});e.tree=JSON.parse(n);_laneTree=e.tree;console.log(_laneTree);mainMenu()}else if(jQuery.type(e.tree)==="array"){laneGroup=true;mainMenu()}else{$(_lanes).each(function(e){laneGroup=false;var t=_lanes[e];if(_lang=="en-lang"){$lanes.append("<li><a id='"+t.id+"' class='kiosk-link block' href='#' onclick=\" toggleLaneType('"+t.id+"')\">"+"<span>"+t.en+"</span></a></li>")}else if(_lang=="kk-lang"){$lanes.append("<li><a id='"+t.id+"' class='kiosk-link block' href='#' onclick=\" toggleLaneType('"+t.id+"')\">"+"<span>"+t.kk+"</span></a></li>")}else{$lanes.append("<li><a id='"+t.id+"' class='kiosk-link block' href='#' onclick=\" toggleLaneType('"+t.id+"')\">"+"<span>"+t.ru+"</span></a></li>")}})}setTimeout(function(){$("#kiosk-step-2").hide();$("#kiosk-step-3").hide();$("#kiosk-step-iin").hide();$("#kiosk-step-1").show()},12e4);if(_lang=="kk-lang"){kk_ru=_kk}else if(_lang=="ru-lang"){kk_ru=_ru}else{kk_ru=_ru}$("#reservation_title").text(kk_ru.reservation_title);$("#yes").text(kk_ru.yes);$("#no").text(kk_ru.no);$("#kiosk-backspace").text(kk_ru.kiosk_backspace);$("#attention").text(kk_ru.attention);$("#lead").text(kk_ru.lead);var n="7(7__) ___-____";$("#kiosk-iin-input").html(n)}function mainMenu(){var e=0;jQuery(_laneTree).each(function(t){var n=getMainLane(_laneTree[t].id).sublanes;jQuery(n).each(function(t){var r=getLane(n[t]);treeLanes[e++]=r});console.log("_laneTree");var r=_laneTree[t];if(_lang=="en-lang"){$lanes.append("<li><a class='mainLane kiosk-link block' href='#' data-id='"+r.id+"'>"+"<span>"+r.en+"</span></a></li>")}else if(_lang=="kk-lang"){$lanes.append("<li><a class='mainLane kiosk-link block' href='#' data-id='"+r.id+"'>"+"<span>"+r.kk+"</span></a></li>")}else{$lanes.append("<li><a class='mainLane kiosk-link block' href='#' data-id='"+r.id+"'>"+"<span>"+r.ru+"</span></a></li>")}});if(_lanes.length>treeLanes.length){$(_lanes).each(function(e){laneGroup=true;flag=false;var t=_lanes[e];$(treeLanes).each(function(e){console.log(treeLanes[e].id+" "+t.id);if(treeLanes[e].id==t.id){flag=true;return false}});if(flag==false){if(_lang=="en-lang"){$lanes.append("<li><a id='"+t.id+"' class='kiosk-link block' href='#' onclick=\" toggleLaneType('"+t.id+"')\">"+"</a></li>")}else if(_lang=="kk-lang"){$lanes.append("<li><a id='"+t.id+"' class='kiosk-link block' href='#' onclick=\" toggleLaneType('"+t.id+"')\">"+"</a></li>")}else{$lanes.append("<li><a id='"+t.id+"' class='kiosk-link block' href='#' onclick=\" toggleLaneType('"+t.id+"')\">"+"</a></li>")}}})}jQuery(".mainLane").click(function(){laneGroup=false;$lanes.empty();console.log("mainLane");console.log(jQuery(this).attr("data-id"));console.log(getMainLane(jQuery(this).attr("data-id")));var e=getMainLane(jQuery(this).attr("data-id")).sublanes;console.log(e);step3.fadeOut(300,function(){jQuery(e).each(function(t){var n=getLane(e[t]);$lanes.append("<li><a id='"+n.id+"' class='kiosk-link block' href='#' onclick=\" toggleLaneType('"+n.id+"')\">"+"</a></li>")});step3.fadeIn(300)})})}function getMainLane(e){var t=null;jQuery(_laneTree).each(function(n){var r=_laneTree[n];if(r.id==e){t=r}});return t}function cleariin(){print_iin.fadeOut();$("#kiosk-iin-input").empty();var e="7(7__) ___-____";$("#kiosk-iin-input").html(e)}function clearAll(){clearLanes();cleariin();clearActiveLanes()}function clearActiveLanes(){print_services.fadeOut();lanes="";jQuery(_lanes).each(function(e){jQuery("#"+_lanes[e].id).removeClass("active");jQuery("#"+_lanes[e].id).find(".tick-pic, figure").hide()});clearLanes()}function clearLanes(){jQuery(_lanes).each(function(e){jQuery("#laneNumber"+_lanes[e].id).empty();jQuery("#laneNumber"+_lanes[e].id).hide()})}function _init(e){console.log("init");_data=e;if(e.lanes){_lanes=e.lanes;console.log(_lanes)}if(e.group){_group=e.group}if(e.reservations){_reservations=e.reservations}iinFake=$("#kiosk-iin-input");$("#kk-lang").click(function(){_initFromLang(e,"kk-lang");step1.fadeOut(300,function(){step3.fadeIn(300)})});$("#ru-lang").click(function(){_initFromLang(e,"ru-lang");step1.fadeOut(300,function(){step3.fadeIn(300)})});$("#en-lang").click(function(){_initFromLang(e,"en-lang");step1.fadeOut(300,function(){step3.fadeIn(300)})});console.log("head_---------------------------------------");jQuery("head").empty();document.title="Киоск CloudQueue";jQuery("head").append(jQuery("<meta charset='utf8'><meta content='width=device-width' name='viewport'><link href='stylesheets/screen.css' media='print,screen' rel='stylesheet'><link href='stylesheets/kiosk.css' media='print,screen' rel='stylesheet'><link href='http://fonts.googleapis.com/css?family=Ubuntu&subset=latin,cyrillic' rel='stylesheet' type='text/css'>"))}function getLane(e){var t=null;$(_lanes).each(function(n){var r=_lanes[n];if(r.id==e){t=r}});return t}function bot(){_bot=true;setInterval(function(){var e=parseInt(Math.random()*1e5);if(e>5e4){setTimeout(function(){$("#ru-lang").click();console.log("ru-lang")},2500);setTimeout(function(){$("#no").click();console.log("no")},5e3);setTimeout(function(){$("#fils01a02").click();console.log("a")},7500);setTimeout(function(){$("#fils01a02").click();console.log("kiosk-print-services")},1e4)}else{setTimeout(function(){$("#kk-lang").click();console.log("ru-lang")},2500);setTimeout(function(){$("#no").click();console.log("no")},5e3);setTimeout(function(){$("#fils01a02").click();console.log("a")},7500);setTimeout(function(){$("#fils01a02").click();console.log("kiosk-print-services")},1e4)}},15e3)}function _onMessage(e){console.log("_onMessage:"+e);var t={};try{t=JSON.parse(e)}catch(n){console.warn("Kiosk got non-JSON message:"+e)}console.log(t);if(t.ticket){jQuery("#ticketCode").text(t.ticket.code);var r=t.ticket.clientIin;if(r.length==""){r="000000000000"}if(r!="000000000000"){$("#clientIdMessage").text("ID:");$("#clientId").text(r);$("#cli").show()}else{$("#cli").hide()}$("#ticketCreateDateMessage").text(kk_ru.ticketCreateDateMessage);var i=new Date;$("#ticketCreateDate").text(i.toJSON().split("T")[0]+" "+i.toTimeString().split(" ")[0]);$("#laneTypesMessage").text(kk_ru.laneTypesMessage);var s="";$(t.ticket.lanes).each(function(e){if(t.ticket.lanes[e].length>0){var n=t.ticket.lanes[e];var r=0;for(var i in _lanes){lane=_lanes[i];if(lane.id==getLane(n).id){if(t.ticket.isReserved)r=lane.reserved-1;else r=lane.count+lane.reserved-1}}if(_lang=="en-lang"){s+=getLane(n).en+" ("+r+")"+", "}else if(_lang=="kk-lang"){s+=getLane(n).kk+" ("+r+")"+", "}else{s+=getLane(n).ru+" ("+r+")"+", "}}});s=s.substr(0,s.length-2);console.log(s);$("#laneTypes").text(s+"");var o=0;$(t.ticket.lanes).each(function(e){var n=t.ticket.lanes[e];$(_lanes).each(function(e){var r=_lanes[e];if(r.id==n){console.log(r.count+" / "+r.reserved);if(t.ticket.isReserved){o=o+r.reserved-1;var i=-1;for(var s in _reservations){var u=_reservations[s];if(u.id==t.ticket.clientIin&&t.ticket.clientIin!=undefined){i=s;break}}if(i!=-1)_reservations.splice(i,1)}else o=o+r.count+r.reserved-1}})});$("#waitingClientsPrintMessage").text(kk_ru.waitingClientsPrintMessage+o);if(_bot==false){console.log("window");window.print()}console.log("BOT"+_bot);$("#kiosk-step-2").hide();$("#kiosk-step-iin").hide();$("#kiosk-step-3").hide();setTimeout(function(){$("#kiosk-step-1").show()},500)}else if(t.pubsub){console.log("**** PUBSUB ****");console.log(t);$(t.lanes).each(function(e){var n=t.lanes[e];$(_lanes).each(function(e){var t=_lanes[e];if(t.id==n.id){t.count=n.count;t.reserved=n.reserved;_lanes[e]=t}})});if(t.reservation){_reservations.push(t.reservation)}}}function onConnect(){firstTime++;setTimeout(function(){$(".panel").fadeIn("slow");nextScene("lanes")},600);console.log(XmppClient.connection.sid)}function _onStatus(e){if(e=="CONNECTED"||e=="ATTACHED"){onConnect()}if(e=="DISCONNECTED"){$(".panel").fadeOut("slow")}}function printTicket(){console.log("print ticket");var e=iinFake.text();var t=e.substr(2,3)+e.substr(7,3)+e.substr(11,4);console.log("I AM IN IF");if(lanes&&lanes.length>0){console.log("enqueue print");iin=null;enqueue(_lang)}clearAll()}function enqueue(e){var t=iin;console.log(t);if(t==null){t="000000000000"}var n=lanes.split(";");var r=new Array;$(n).each(function(e){if(n[e]!=""&&n[e].length!=0){r.push(n[e])}});var i={action:"enqueue",lang:e,client:t,lanes:r};console.log("123123");console.log(i);XmppClient.send("queue",JSON.stringify(i))}var _ru={reservation_title:"Бронировали ли вы очередь?",yes:"Да",kiosk_backspace:"Удалить",attention:"Внимание!",lead:"Вашего телефонного номера нету в системе. Проверьте правильно ли введен номер.",kiosk_iin_input:"Введите номер телефона",ticketCreateDateMessage:"Время:",laneTypesMessage:"Услуги:",waitingClientsPrintMessage:"Количество клиентов перед Вами: ",no:"Нет"};var _kk={reservation_title:"Бронь арқылы ма?",yes:"Иә",kiosk_backspace:"Жою",attention:"Назар аударыңыз!",lead:"Сіздің телефон нөміріңіз базадан табылмады. Нөмеріңіздің нақты дұрыс екенін тексеріңіз",kiosk_iin_input:"Телефон нөмірін енгізіңіз",ticketCreateDateMessage:"Уақыт",laneTypesMessage:"Қызметтер",waitingClientsPrintMessage:"Сіздің алдыңыздағы клиент саны: ",no:"Жоқ"};var _bot=false;var iinFake,iin=null,lanes="",$lanes=$("#kiosk-services"),_lanes=null,_reservations=new Array,_laneTree=null,_group={},_lang=null,_data=null;var firstTime=0;var treeLanes=new Array